# Обнаружен цикл импорта

Компонент, директива или Pipe, на которые ссылается данный компонент, требуют от компилятора добавления импорта, который
приведет к циклу импортов.
Например, рассмотрим сценарий, где `ParentComponent` ссылается на `ChildComponent` в своем шаблоне:

<docs-code header="parent.component.ts" language="angular-ts">
import {Component} from '@angular/core';
import {ChildComponent} from './child.component';

@Component({
selector: 'app-parent',
imports: [ChildComponent],
template: '<app-child/>',
})
export class ParentComponent {}
</docs-code>

<docs-code header="child.component.ts" language="angular-ts">
import {Component, inject} from '@angular/core';
import {ParentComponent} from './parent.component';

@Component({
selector: 'app-child',
template: 'The child!',
})
export class ChildComponent {
private parent = inject(ParentComponent);
}
</docs-code>

Уже существует импорт из `child.component.ts` в `parent.component.ts`, так как `ChildComponent` ссылается на
`ParentComponent` в своем конструкторе.

Шаблон родительского компонента содержит `<child></child>`.
Следовательно, сгенерированный код для этого шаблона должен содержать ссылку на класс `ChildComponent`.
Чтобы создать эту ссылку, компилятору пришлось бы добавить импорт из `parent.component.ts` в `child.component.ts`, что
вызвало бы цикл импорта:

<docs-code language="text">

parent.component.ts -> child.component.ts -> parent.component.ts

</docs-code>

## Remote Scoping

Если вы используете NgModules, то во избежание добавления импортов, создающих циклы, в класс `NgModule`, где объявлен
компонент, связывающий зависимости, добавляется дополнительный код.

Это называется "remote scoping" (удаленная область видимости).

## Библиотеки

К сожалению, код "remote scoping" имеет побочные эффекты (что препятствует Tree Shaking) и не может использоваться в
библиотеках.
Поэтому при сборке библиотек с использованием настройки `"compilationMode": "partial"`, любой компонент, требующий
циклического импорта, вызовет ошибку компилятора `NG3003`.

## Отладка ошибки

Цикл, который был бы сгенерирован, отображается как часть сообщения об ошибке.
Например:

<docs-code hideCopy="true">

The component ChildComponent is used in the template but importing it would create a cycle:
/parent.component.ts -> /child.component.ts -> /parent.component.ts

</docs-code>

Используйте это сообщение, чтобы определить, как используемый компонент, Pipe или директива зависят от компилируемого
компонента.
Вот несколько идей для решения проблемы:

- Попробуйте перестроить зависимости, чтобы избежать цикла.
  Например, используйте промежуточный интерфейс, хранящийся в отдельном файле, который можно импортировать в оба
  зависимых файла без создания цикла импорта.
- Переместите классы, ссылающиеся друг на друга, в один файл, чтобы избежать импортов между ними.
- Преобразуйте операторы импорта в импорты только типов (используя синтаксис `import type`), если импортированные
  объявления используются только как типы, так как такие импорты не создают циклов.
