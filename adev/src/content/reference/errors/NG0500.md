# Несоответствие узлов при гидратации

Эта ошибка означает, что в процессе гидратации Angular ожидал структуру DOM, соответствующую той, что была отрендерена и
размечена во время рендеринга на стороне сервера (SSR). Однако на клиенте дерево DOM оказалось отличным от того, что
было создано на сервере.

Обычно эта ошибка возникает из-за прямых манипуляций с DOM с использованием нативных API браузера, которые изменяют
структуру DOM в обход Angular. Она также возникает при использовании `innerHTML` или `outerHTML` для установки
HTML-контента, что аналогичным образом изменяет структуру DOM вне контроля Angular. Вы можете исправить это, переписав
компонент с использованием нативных API Angular вместо нативных API браузера. Если это невозможно, можно добавить
атрибут `ngSkipHydration` к хост-узлу вашего компонента, что отключит гидратацию для компонента и его потомков.
Использование `ngSkipHydration` должно рассматриваться как крайняя мера и считаться багом, который необходимо исправить.

Подробнее о гидратации читайте в [этом руководстве](guide/hydration).

Следующий пример вызовет ошибку:

```typescript
@Component({
  selector: 'app-example',
  template: '<div><span>world</span></div>',
})
export class ExampleComponent {
  hostElement = inject(ElementRef).nativeElement;

  ngOnInit() {
    // Создаем новый элемент <p> с текстом `Hello` внутри
    const newNode = document.createElement('p');
    newNode.innerHTML = 'Hello';

    // Вставляем <p> перед первым элементом. Поскольку у Angular нет информации
    // об элементе <p>, он будет искать элемент <div> на позиции первого
    // элемента. В результате будет выброшена ошибка несоответствия гидратации.
    // Вместо этого обновите шаблон компонента, чтобы создать элемент <p>.
   this.hostElement.insertBefore(newNode, this.hostElement.firstChild);
 }
}
```

## Отладка ошибки

Сообщение об ошибке в консоли разработчика должно содержать информацию о конкретной части структуры DOM приложения,
вызывающей проблему. Проверьте эту часть приложения на наличие ошибок, связанных с гидратацией, таких как прямые
манипуляции с DOM через нативные API.

Убедитесь, что ваш шаблон имеет валидную HTML-структуру. Дополнительную информацию см.
в [руководстве по гидратации](guide/hydration#valid-html-structure).

В качестве временного решения можно добавить атрибут `ngSkipHydration` к хост-узлу компонента.

Если ваше приложение работает в среде разработки, но вы видите ошибки гидратации в продакшн-сборках, убедитесь, что
сгенерированный HTML, доставляемый в браузер, содержит узлы-комментарии, созданные Angular во время рендеринга на
сервере. Эти узлы-комментарии используются средой выполнения Angular в качестве якорей для контейнеров представлений (
как с гидратацией, так и без неё), и процесс гидратации ожидает их наличия на исходных местах. Если у вас есть
пользовательская логика для удаления комментариев из HTML, сгенерированного при SSR, или вы настроили CDN на их удаление
перед отдачей контента — отключите удаление узлов-комментариев и проверьте, исчезли ли ошибки гидратации.
