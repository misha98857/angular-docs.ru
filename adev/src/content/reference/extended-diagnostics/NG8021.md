# Ошибка конфигурации триггеров в @defer

Эта диагностика обнаруживает недостижимые или избыточные триггеры в блоках `@defer`.

```typescript

import {Component} from '@angular/core';

@Component({
  template: `
    @defer (on immediate; on timer(500ms)) {
      <large-component />
    }
  `
})
class MyComponent {}
```

## В чем проблема?

Диагностика выявляет несколько проблемных паттернов в конфигурации триггеров `@defer`, которые приводят к:

- **Лишнему коду**, который никогда не влияет на поведение приложения.
- **Упущенным возможностям оптимизации** для повышения производительности.
- **Недостижимым триггерам предзагрузки**, которые никогда не выполнятся.

## Случаи предупреждений диагностики

Эта диагностика отмечает следующие проблемные паттерны:

### `immediate` вместе с триггерами предзагрузки

**Плохо — предзагрузка никогда не запускается**

```typescript
@Component({
  template: `
    @defer (on immediate; prefetch on idle) {
      <my-cmp />
    }
  `
})
class MyComponent {}
```

**Хорошо — удалите избыточную предзагрузку**

```typescript
@Component({
  template: `
    @defer (on immediate) {
      <my-cmp />
    }
  `
})
class MyComponent {}
```

### Таймер предзагрузки установлен не раньше основного таймера

**Плохо — предзагрузка происходит позже основного триггера**

```typescript
@Component({
  template: `
    @defer (on timer(100ms); prefetch on timer(3000ms)) {
      <my-cmp />
    }
  `
})
class MyComponent {}
```

**Плохо — одинаковое время не дает преимуществ**

```typescript
@Component({
  template: `
    @defer (on timer(500ms); prefetch on timer(500ms)) {
      <my-cmp />
    }
  `
})
class MyComponent {}
```

**Хорошо — предзагрузка срабатывает раньше**

```typescript
@Component({
  template: `
    @defer (on timer(1000ms); prefetch on timer(500ms)) {
      <large-component />
    }
  `
})
class MyComponent {}
```

### Идентичные триггеры предзагрузки и основные триггеры

**Плохо — идентичный триггер viewport**

```typescript
@Component({
  template: `
    @defer (on viewport; prefetch on viewport) {
      <my-cmp />
    }
  `
})
class MyComponent {}
```

**Плохо — идентичная цель взаимодействия**

```typescript
@Component({
  template: `
    <button #loadBtn>Load</button>
    @defer (on interaction(loadBtn); prefetch on interaction(loadBtn)) {
      <large-component />
    }
  `
})
class MyComponent {}
```

**Хорошо — удалите избыточную предзагрузку**

```typescript
@Component({
  template: `
    <button #loadBtn>Load</button>
    @defer (on interaction(loadBtn)) {
      <large-component />
    }
  `
})
class MyComponent {}
```

**Хорошо — используйте разные цели для предзагрузки и основного контента**

```typescript
@Component({
  template: `
    <div #hoverArea>Hover to prefetch</div>
    <button #clickBtn>Click to load</button>
    @defer (on interaction(clickBtn); prefetch on hover(hoverArea)) {
      <large-component />
    }
  `
})
class MyComponent {}
```

## Требования к конфигурации

Для работы любой расширенной диагностики необходимо включить [
`strictTemplates`](tools/cli/template-typecheck#strict-mode).
`deferTriggerMisconfiguration` не имеет дополнительных требований, кроме `strictTemplates`.

## Что делать, если этого нельзя избежать?

Эту диагностику можно отключить, отредактировав файл `tsconfig.json` проекта:

```json
{
  "angularCompilerOptions": {
    "extendedDiagnostics": {
      "checks": {
        "deferTriggerMisconfiguration": "suppress"
      }
    }
  }
}
```

См. [конфигурацию расширенной диагностики](extended-diagnostics#configuration) для получения дополнительной информации.
