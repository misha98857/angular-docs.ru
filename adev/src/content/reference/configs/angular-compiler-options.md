# Опции компилятора Angular

При использовании [AOT-компиляции (ahead-of-time)](tools/cli/aot-compiler) вы можете управлять процессом компиляции
приложения, указывая опции компилятора Angular
в [файле конфигурации TypeScript](https://www.typescriptlang.org/docs/handbook/tsconfig-json.html).

Объект опций Angular, `angularCompilerOptions`, находится на одном уровне с объектом `compilerOptions`, который
предоставляет стандартные опции для компилятора TypeScript.

<docs-code header="tsconfig.json" path="adev/src/content/examples/angular-compiler-options/tsconfig.json" region="angular-compiler-options"/>

## Наследование конфигурации с помощью `extends`

Как и компилятор TypeScript, AOT-компилятор Angular поддерживает `extends` в секции `angularCompilerOptions` файла
конфигурации TypeScript.
Свойство `extends` находится на верхнем уровне, параллельно `compilerOptions` и `angularCompilerOptions`.

Конфигурация TypeScript может наследовать настройки из другого файла, используя свойство `extends`.
Опции конфигурации из базового файла загружаются первыми, затем переопределяются опциями из наследующего файла
конфигурации.

Например:

<docs-code header="tsconfig.app.json" path="adev/src/content/examples/angular-compiler-options/tsconfig.app.json" region="angular-compiler-options-app"/>

Для получения дополнительной информации
см. [Справочник TypeScript](https://www.typescriptlang.org/docs/handbook/tsconfig-json.html).

## Опции шаблона

Следующие опции доступны для настройки AOT-компилятора Angular.

### `annotationsAs`

Изменяет способ генерации специфичных для Angular аннотаций для улучшения Tree Shaking.
Аннотации, не относящиеся к Angular, не затрагиваются.
Одно из значений: `static fields` или `decorators`. Значение по умолчанию — `static fields`.

- По умолчанию компилятор заменяет декораторы статическим полем в классе, что позволяет продвинутым инструментам Tree
  Shaking, таким как [Closure compiler](https://github.com/google/closure-compiler), удалять неиспользуемые классы.
- Значение `decorators` оставляет декораторы на месте, что ускоряет компиляцию.
  TypeScript генерирует вызовы помощника `__decorate`.
  Используйте `--emitDecoratorMetadata` для рефлексии во время выполнения.

  ПОЛЕЗНО: Полученный код не может корректно подвергаться Tree Shaking.

### `annotateForClosureCompiler`

<!-- vale Angular.Angular_Spelling = NO -->

Если `true`, используется [Tsickle](https://github.com/angular/tsickle) для аннотирования сгенерированного JavaScript
комментариями [JSDoc](https://jsdoc.app), необходимыми
для [Closure Compiler](https://github.com/google/closure-compiler).
По умолчанию `false`.

<!-- vale Angular.Angular_Spelling = YES -->

### `compilationMode`

Указывает используемый режим компиляции.
Доступны следующие режимы:

| Режимы      | Подробности                                                                                  |
| :---------- | :------------------------------------------------------------------------------------------- |
| `'full'`    | Генерирует полностью AOT-скомпилированный код в соответствии с используемой версией Angular. |
| `'partial'` | Генерирует код в стабильной, но промежуточной форме, подходящей для публикуемой библиотеки.  |

Значение по умолчанию — `'full'`.

Для большинства приложений правильным режимом компиляции является `'full'`.

Используйте `'partial'` для независимо публикуемых библиотек, таких как NPM-пакеты.
Компиляция в режиме `'partial'` создает стабильный промежуточный формат, который лучше поддерживает использование
приложениями, созданными на разных версиях Angular.
Библиотеки, собираемые из "HEAD" вместе с приложениями и использующие ту же версию Angular (например, в
монорепозитории), могут использовать `'full'`, так как риск расхождения версий отсутствует.

### `disableExpressionLowering`

Если `true` (по умолчанию), преобразует код, который используется или может использоваться в аннотации, чтобы его можно
было импортировать из модулей фабрики шаблонов.
См. [переписывание метаданных](tools/cli/aot-compiler#metadata-rewriting) для получения дополнительной информации.

Если `false`, отключает это переписывание, требуя выполнения переписывания вручную.

### `disableTypeScriptVersionCheck`

Если `true`, компилятор не проверяет версию TypeScript и не сообщает об ошибке при использовании неподдерживаемой
версии.
Не рекомендуется, так как неподдерживаемые версии TypeScript могут иметь неопределенное поведение.
По умолчанию `false`.

### `enableI18nLegacyMessageIdFormat`

Указывает компилятору шаблонов Angular создавать устаревшие идентификаторы для сообщений, помеченных в шаблонах
атрибутом `i18n`.
См. [Пометка текста для перевода][GuideI18nCommonPrepareMarkTextInComponentTemplate] для получения дополнительной
информации о разметке сообщений для локализации.

Установите эту опцию в `false`, если только ваш проект не зависит от переводов, созданных ранее с использованием
устаревших ID.
По умолчанию `true`.

Инструменты извлечения сообщений до Ivy создавали различные устаревшие форматы для идентификаторов сообщений.
Эти форматы имеют некоторые проблемы, такие как обработка пробелов и зависимость от информации внутри исходного HTML
шаблона.

Новый формат сообщений более устойчив к изменениям пробелов, одинаков для всех форматов файлов перевода и может быть
создан непосредственно из вызовов `$localize`.
Это позволяет сообщениям `$localize` в коде приложения использовать тот же ID, что и идентичные сообщения `i18n` в
шаблонах компонентов.

### `enableResourceInlining`

Если `true`, заменяет свойства `templateUrl` и `styleUrls` во всех декораторах `@Component` на встроенное содержимое в
свойствах `template` и `styles`.

Если включено, выходной файл `.js` от `ngc` не включает URL-адреса лениво загружаемых шаблонов или стилей.

Для проектов библиотек, созданных с помощью Angular CLI, значение по умолчанию в конфигурации разработки — `true`.

### `enableLegacyTemplate`

Если `true`, включает устаревший элемент `<template>` вместо `<ng-template>`.
По умолчанию `false`.
Может потребоваться для некоторых сторонних библиотек Angular.

### `flatModuleId`

ID модуля, используемый для импорта плоского модуля (когда `flatModuleOutFile` равен `true`).
Ссылки, созданные компилятором шаблонов, используют это имя модуля при импорте символов из плоского модуля.
Игнорируется, если `flatModuleOutFile` равен `false`.

### `flatModuleOutFile`

Если `true`, генерирует индекс плоского модуля с заданным именем файла и соответствующие метаданные плоского модуля.
Используйте для создания плоских модулей, упакованных аналогично `@angular/core` и `@angular/common`.
При использовании этой опции `package.json` библиотеки должен ссылаться на созданный индекс плоского модуля вместо
индексного файла библиотеки.

Создает только один файл `.metadata.json`, содержащий все метаданные, необходимые для символов, экспортируемых из
индекса библиотеки.
В созданных файлах `.ngfactory.js` индекс плоского модуля используется для импорта символов. Символы включают как
публичный API из индекса библиотеки, так и скрытые внутренние символы.

По умолчанию файл `.ts`, указанный в поле `files`, считается индексом библиотеки.
Если указано более одного файла `.ts`, используется `libraryIndex` для выбора файла.
Если указано более одного файла `.ts` без `libraryIndex`, возникает ошибка.

Индекс плоского модуля `.d.ts` и `.js` создается с заданным именем `flatModuleOutFile` в том же месте, что и файл
`.d.ts` индекса библиотеки.

Например, если библиотека использует файл `public_api.ts` в качестве индекса модуля, поле `files` в `tsconfig.json`
будет `["public_api.ts"]`.
Опция `flatModuleOutFile` может быть установлена, например, в `"index.js"`, что создаст файлы `index.d.ts` и
`index.metadata.json`.
Поле `module` в `package.json` библиотеки будет `"index.js"`, а поле `typings` — `"index.d.ts"`.

### `fullTemplateTypeCheck`

Если `true` (рекомендуемое значение), включает
фазу [валидации выражений привязки](tools/cli/aot-compiler#binding-expression-validation) компилятора шаблонов. Эта фаза
использует TypeScript для проверки выражений привязки.
Для получения дополнительной информации см. [Проверка типов в шаблонах](tools/cli/template-typecheck).

По умолчанию `false`, но при использовании команды Angular CLI `ng new --strict` устанавливается в `true` в конфигурации
нового проекта.

ВАЖНО: Опция `fullTemplateTypeCheck` устарела в Angular 13 в пользу семейства опций компилятора `strictTemplates`.

### `generateCodeForLibraries`

Если `true`, создает файлы фабрик (`.ngfactory.js` и `.ngstyle.js`) для файлов `.d.ts` с соответствующим файлом
`.metadata.json`. Значение по умолчанию — `true`.

Если `false`, файлы фабрик создаются только для файлов `.ts`.
Делайте это при использовании сводок фабрик (factory summaries).

### `preserveWhitespaces`

Если `false` (по умолчанию), удаляет пустые текстовые узлы из скомпилированных шаблонов, что приводит к уменьшению
размера модулей фабрик шаблонов.
Установите в `true`, чтобы сохранить пустые текстовые узлы.

ПОЛЕЗНО: При использовании гидратации рекомендуется использовать `preserveWhitespaces: false` (значение по умолчанию).
Если вы решите включить сохранение пробелов, добавив `preserveWhitespaces: true` в ваш tsconfig, вы можете столкнуться с
проблемами при гидратации. Это пока не полностью поддерживаемая конфигурация. Убедитесь, что эта настройка согласована
между файлами tsconfig сервера и клиента. См. [руководство по гидратации](guide/hydration#preserve-whitespaces) для
получения подробной информации.

### `skipMetadataEmit`

Если `true`, не создает файлы `.metadata.json`.
По умолчанию `false`.

Файлы `.metadata.json` содержат информацию из файла `.ts`, необходимую компилятору шаблонов, которая не включена в файл
`.d.ts`, создаваемый компилятором TypeScript.
Эта информация включает, например, содержимое аннотаций (таких как шаблон компонента), которые TypeScript помещает в
файл `.js`, но не в файл `.d.ts`.

Вы можете установить значение `true` при использовании сводок фабрик, так как они включают копию информации, находящейся
в файле `.metadata.json`.

Установите в `true`, если вы используете опцию `--outFile` TypeScript, так как файлы метаданных недействительны для
этого стиля вывода TypeScript.
Сообщество Angular не рекомендует использовать `--outFile` с Angular.
Вместо этого используйте сборщик, такой как [webpack](https://webpack.js.org).

### `skipTemplateCodegen`

Если `true`, не генерирует файлы `.ngfactory.js` и `.ngstyle.js`.
Это отключает большую часть компилятора шаблонов и отключает отчеты о диагностике шаблонов.

Может использоваться для указания компилятору шаблонов создавать файлы `.metadata.json` для распространения с пакетом
`npm`. Это позволяет избежать создания файлов `.ngfactory.js` и `.ngstyle.js`, которые нельзя распространять в `npm`.

Для проектов библиотек, созданных с помощью Angular CLI, значение по умолчанию в конфигурации разработки — `true`.

### `strictMetadataEmit`

Если `true`, сообщает об ошибке в файле `.metadata.json`, если `"skipMetadataEmit"` равно `false`.
По умолчанию `false`.
Используйте только тогда, когда `"skipMetadataEmit"` равно `false`, а `"skipTemplateCodegen"` равно `true`.

Эта опция предназначена для проверки файлов `.metadata.json`, создаваемых для упаковки с пакетом `npm`.
Валидация является строгой и может выдавать ошибки для метаданных, которые никогда не вызвали бы ошибку при
использовании компилятором шаблонов.
Вы можете подавить ошибку, выдаваемую этой опцией для экспортируемого символа, включив `@dynamic` в комментарий,
документирующий символ.

Наличие ошибок в файлах `.metadata.json` допустимо.
Компилятор шаблонов сообщает об этих ошибках, если метаданные используются для определения содержимого аннотации.
Сборщик метаданных не может предсказать символы, предназначенные для использования в аннотации. Он превентивно включает
узлы ошибок в метаданные для экспортируемых символов.
Компилятор шаблонов затем может использовать узлы ошибок для сообщения об ошибке, если эти символы используются.

Если клиент библиотеки намеревается использовать символ в аннотации, компилятор шаблонов обычно не сообщает об этом. Это
сообщается после того, как клиент фактически использует символ.
Эта опция позволяет обнаруживать такие ошибки на этапе сборки библиотеки и используется, например, при создании самих
библиотек Angular.

Для проектов библиотек, созданных с помощью Angular CLI, значение по умолчанию в конфигурации разработки — `true`.

### `strictInjectionParameters`

Если `true`, сообщает об ошибке для переданного параметра, тип внедрения которого невозможно определить.
Если `false`, параметры конструктора классов, помеченных `@Injectable`, чей тип невозможно разрешить, вызывают
предупреждение.
Рекомендуемое значение — `true`, но значение по умолчанию — `false`.

При использовании команды Angular CLI `ng new --strict` устанавливается в `true` в конфигурации созданного проекта.

### `strictTemplates`

Если `true`, включает [строгую проверку типов в шаблонах](tools/cli/template-typecheck#strict-mode).

Флаги строгости, которые включает эта опция, позволяют включать и отключать определенные типы строгой проверки типов в
шаблонах.
См. [устранение ошибок шаблонов](tools/cli/template-typecheck#troubleshooting-template-errors).

При использовании команды Angular CLI `ng new --strict` устанавливается в `true` в конфигурации нового проекта.

### `strictStandalone`

Если `true`, сообщает об ошибке, если компонент, директива или pipe не являются standalone.

### `trace`

Если `true`, выводит дополнительную информацию во время компиляции шаблонов.
По умолчанию `false`.

## Опции командной строки

В большинстве случаев вы взаимодействуете с компилятором Angular косвенно,
используя [Angular CLI](reference/configs/angular-compiler-options). При отладке определенных проблем может быть полезно
вызвать компилятор Angular напрямую.
Вы можете использовать команду `ngc`, предоставляемую npm-пакетом `@angular/compiler-cli`, для вызова компилятора из
командной строки.

Команда `ngc` является оберткой вокруг команды компилятора TypeScript `tsc`. Компилятор Angular в основном настраивается
через `tsconfig.json`, тогда как Angular CLI в основном настраивается через `angular.json`.

Помимо файла конфигурации, вы также можете использовать [опции командной строки
`tsc`](https://www.typescriptlang.org/docs/handbook/compiler-options.html) для настройки `ngc`.

[GuideI18nCommonPrepareMarkTextInComponentTemplate]: guide/i18n/prepare#mark-text-in-component-template 'Пометка текста в шаблоне компонента - Подготовка компонента к переводу | Angular'
