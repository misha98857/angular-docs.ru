<docs-decorative-header title="Внедрение зависимостей (DI) в Angular" imgSrc="adev/src/assets/images/dependency_injection.svg"> <!-- markdownlint-disable-line -->

Внедрение зависимостей (Dependency Injection — DI) — это шаблон проектирования, используемый для организации и
совместного использования кода в приложении.
</docs-decorative-header>

TIP: Ознакомьтесь с темой [Основы](essentials/dependency-injection) перед изучением этого подробного руководства.

По мере роста приложения разработчикам часто требуется повторно использовать и совместно использовать функциональность в
разных частях кодовой базы. [Внедрение зависимостей (DI)](https://en.wikipedia.org/wiki/Dependency_injection) — это
шаблон проектирования, используемый для организации и совместного использования кода в приложении, позволяющий вам
«внедрять» функциональность в различные части.

Внедрение зависимостей — популярный шаблон, поскольку он позволяет разработчикам решать распространенные задачи, такие
как:

- **Улучшенная поддерживаемость кода**: Внедрение зависимостей обеспечивает более чистое разделение ответственности, что
  упрощает рефакторинг и уменьшает дублирование кода.
- **Масштабируемость**: Модульную функциональность можно повторно использовать в различных контекстах, что обеспечивает
  более легкое масштабирование.
- **Улучшенное тестирование**: DI позволяет юнит-тестам легко
  использовать [тестовые дублеры (test doubles)](https://en.wikipedia.org/wiki/Test_double) для ситуаций, когда
  использование реальной реализации непрактично.

## Как работает внедрение зависимостей в Angular?

Зависимость — это любой объект, значение, функция или сервис, которые необходимы классу для работы, но которые он не
создает сам. Другими словами, это создает связь между различными частями вашего приложения, поскольку оно не работало бы
без зависимости.

Существует два способа взаимодействия кода с любой системой внедрения зависимостей:

- Код может _предоставлять (provide)_ или делать доступными значения.
- Код может _внедрять (inject)_ или запрашивать эти значения как зависимости.

«Значения» в данном контексте могут быть любым значением JavaScript, включая объекты и функции. Распространенные типы
внедряемых зависимостей включают:

- **Значения конфигурации**: Константы, специфичные для среды, URL-адреса API, флаги функций и т.д.
- **Фабрики**: Функции, которые создают объекты или значения на основе условий выполнения.
- **Сервисы**: Классы, которые предоставляют общую функциональность, бизнес-логику или состояние.

Компоненты и директивы Angular автоматически участвуют в DI, что означает, что они могут внедрять зависимости, _и_ они
сами доступны для внедрения.

## Что такое сервисы?

_Сервис_ Angular — это класс TypeScript, декорированный с помощью `@Injectable`, что делает экземпляр класса доступным
для внедрения в качестве зависимости. Сервисы — это наиболее распространенный способ совместного использования данных и
функциональности во всем приложении.

Распространенные типы сервисов включают:

- **Клиенты данных:** Абстрагируют детали выполнения запросов к серверу для получения и изменения данных.
- **Управление состоянием:** Определяет состояние, общее для нескольких компонентов или страниц.
- **Аутентификация и авторизация:** Управляет аутентификацией пользователя, хранением токенов и контролем доступа.
- **Логирование и обработка ошибок:** Устанавливает общий API для логирования или сообщения состояний ошибок
  пользователю.
- **Обработка событий и диспетчеризация:** Обрабатывает события или уведомления, не связанные с конкретным компонентом,
  или диспетчеризирует события и уведомления компонентам,
  следуя [шаблону наблюдателя (observer pattern)](https://en.wikipedia.org/wiki/Observer_pattern).
- **Утилитные функции:** Предлагает повторно используемые утилитные функции, такие как форматирование данных, валидация
  или вычисления.

Следующий пример объявляет сервис с именем `AnalyticsLogger`:

```ts
import { Injectable } from '@angular/core';

@Injectable({ providedIn: 'root' })
export class AnalyticsLogger {
  trackEvent(category: string, value: string) {
    console.log('Analytics event logged:', {
      category,
      value,
      timestamp: new Date().toISOString()
    })
  }
}
```

NOTE: Опция `providedIn: 'root'` делает этот сервис доступным во всем вашем приложении как синглтон. Это рекомендуемый
подход для большинства сервисов.

## Внедрение зависимостей с помощью `inject()`

Вы можете внедрять зависимости, используя функцию Angular `inject()`.

Вот пример навигационной панели, которая внедряет `AnalyticsLogger` и сервис Angular `Router`, чтобы позволить
пользователям переходить на другую страницу, отслеживая событие.

```angular-ts
import { Component, inject } from '@angular/core';
import { Router } from '@angular/router';
import { AnalyticsLogger } from './analytics-logger';

@Component({
  selector: 'app-navbar',
  template: `
    <a href="#" (click)="navigateToDetail($event)">Detail Page</a>
  `,
})
export class NavbarComponent {
  private router = inject(Router);
  private analytics = inject(AnalyticsLogger);

  navigateToDetail(event: Event) {
    event.preventDefault();
    this.analytics.trackEvent('navigation', '/details');
    this.router.navigate(['/details']);
  }
}
```

### Где можно использовать `inject()`?

Вы можете внедрять зависимости во время создания компонента, директивы или сервиса. Вызов [`inject`](/api/core/inject) может находиться либо в `constructor`, либо в инициализаторе поля. Вот несколько распространенных примеров:

```ts
@Component({...})
export class MyComponent {
  // ✅ В инициализаторе поля класса
  private service = inject(MyService);

  // ✅ В теле конструктора
  private anotherService: MyService;

  constructor() {
    this.anotherService = inject(MyService);
  }
}
```

```ts
@Directive({...})
export class MyDirective {
  // ✅ В инициализаторе поля класса
  private element = inject(ElementRef);
}
```

```ts
import { Injectable, inject } from '@angular/core';
import { HttpClient } from '@angular/common/http';

@Injectable({ providedIn: 'root' })
export class MyService {
  // ✅ В сервисе
  private http = inject(HttpClient);
}
```

```ts
export const authGuard = () => {
  // ✅ В гарде (guard) маршрута
  const auth = inject(AuthService);
  return auth.isAuthenticated();
}
```

Angular использует термин «контекст внедрения» (injection context) для описания любого места в вашем коде, где вы можете вызвать [`inject`](/api/core/inject). Хотя создание компонента, директивы и сервиса является наиболее распространенным случаем, см. [контексты внедрения](guide/di/dependency-injection-context) для получения дополнительных сведений.

Для получения дополнительной информации см. [документацию по API inject](api/core/inject#usage-notes).

## Следующие шаги

Теперь, когда вы понимаете основы внедрения зависимостей в Angular, вы готовы узнать, как создавать свои собственные
сервисы.

Следующее руководство, [Создание и использование сервисов](guide/di/creating-and-using-services), покажет вам:

- Как создать сервис с помощью Angular CLI или вручную.
- Как работает шаблон `providedIn: 'root'`.
- Как внедрять сервисы в компоненты и другие сервисы.

Это охватывает наиболее распространенный вариант использования сервисов в приложениях Angular.
