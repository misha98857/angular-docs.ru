# Переходы и триггеры анимации

IMPORTANT: Пакет `@angular/animations` теперь устарел. Команда Angular рекомендует использовать нативный CSS с
`animate.enter` и `animate.leave` для анимации во всем новом коде. Узнайте больше в
новом [руководстве по анимации входа и выхода](guide/animations/enter-and-leave). Также
см. [Миграция с пакета анимаций Angular](guide/animations/migration), чтобы узнать, как начать перенос ваших приложений
на чистую CSS-анимацию.

В этом руководстве подробно рассматриваются специальные состояния переходов, такие как подстановочный знак `*` и `void`.
Показано, как эти специальные состояния используются для элементов, входящих в представление и покидающих его.
В этом разделе также рассматриваются множественные триггеры анимации, коллбэки анимации и анимация на основе
последовательностей с использованием ключевых кадров (keyframes).

## Предопределенные состояния и сопоставление с подстановочными знаками

В Angular состояния перехода могут быть определены явно через функцию [`state()`](api/animations/state) или с
использованием предопределенного подстановочного знака `*` и состояния `void`.

### Состояние с подстановочным знаком (Wildcard)

Звездочка `*` или _подстановочный знак_ соответствует любому состоянию анимации.
Это полезно для определения переходов, которые применяются независимо от начального или конечного состояния
HTML-элемента.

Например, переход `open => *` применяется, когда состояние элемента меняется с `open` на любое другое.

<img alt="wildcard state expressions" src="assets/images/guide/animations/wildcard-state-500.png">

Ниже приведен еще один пример кода, использующий состояние с подстановочным знаком вместе с предыдущим примером,
использующим состояния `open` и `closed`.
Вместо определения каждой пары переходов от состояния к состоянию, любой переход в `closed` занимает 1 секунду, а любой
переход в `open` — 0.5 секунды.

Это позволяет добавлять новые состояния без необходимости прописывать отдельные переходы для каждого из них.

<docs-code header="open-close.component.ts" path="adev/src/content/examples/animations/src/app/open-close.component.ts" region="trigger-wildcard1"/>

Используйте синтаксис с двусторонней стрелкой для указания переходов между состояниями в обоих направлениях.

<docs-code header="open-close.component.ts" path="adev/src/content/examples/animations/src/app/open-close.component.ts" region="trigger-wildcard2"/>

### Использование подстановочного знака с несколькими состояниями перехода

В примере с кнопкой, имеющей два состояния, подстановочный знак не так полезен, поскольку существует только два
возможных состояния: `open` и `closed`.
В общем случае используйте состояния с подстановочным знаком, когда элемент имеет несколько потенциальных состояний, в
которые он может перейти.
Если кнопка может измениться с `open` на `closed` или, например, на `inProgress`, использование подстановочного знака
может сократить объем кода.

<img alt="wildcard state with 3 states" src="assets/images/guide/animations/wildcard-3-states.png">

<docs-code header="open-close.component.ts" path="adev/src/content/examples/animations/src/app/open-close.component.ts" region="trigger-transition"/>

Переход `* => *` применяется, когда происходит любое изменение между двумя состояниями.

Переходы сопоставляются в том порядке, в котором они определены.
Таким образом, вы можете применять другие переходы поверх перехода `* => *`.
Например, определите изменения стилей или анимации, которые будут применяться только к `open => closed`, а затем
используйте `* => *` в качестве запасного варианта для пар состояний, которые не указаны отдельно.

Для этого перечислите более конкретные переходы _перед_ `* => *`.

### Использование подстановочных знаков со стилями

Используйте подстановочный знак `*` со стилем, чтобы указать анимации использовать текущее значение стиля и анимировать
его.
Подстановочный знак — это запасное значение, которое используется, если анимируемое состояние не объявлено внутри
триггера.

<docs-code header="open-close.component.ts" path="adev/src/content/examples/animations/src/app/open-close.component.ts" region="transition4"/>

### Состояние void

Используйте состояние `void` для настройки переходов для элемента, который входит на страницу или покидает её.
См. [Анимация входа и выхода из представления](guide/legacy-animations/transition-and-triggers#aliases-enter-and-leave).

### Комбинирование подстановочного знака и состояния void

Комбинируйте подстановочный знак и состояние `void` в переходе, чтобы запускать анимацию при входе и выходе со страницы:

- Переход `* => void` применяется, когда элемент покидает представление, независимо от того, в каком состоянии он
  находился до этого.
- Переход `void => *` применяется, когда элемент входит в представление, независимо от того, какое состояние он
  принимает при входе.
- Состояние с подстановочным знаком `*` соответствует _любому_ состоянию, включая `void`.

## Анимация входа и выхода из представления

В этом разделе показано, как анимировать элементы, входящие на страницу или покидающие её.

Добавьте новое поведение:

- Когда вы добавляете героя в список героев, он как бы влетает на страницу слева.
- Когда вы удаляете героя из списка, он как бы улетает вправо.

<docs-code header="hero-list-enter-leave.component.ts" path="adev/src/content/examples/animations/src/app/hero-list-enter-leave.component.ts" region="animationdef"/>

В приведенном выше коде вы применили состояние `void`, когда HTML-элемент не прикреплен к представлению.

## Псевдонимы :enter и :leave

`:enter` и `:leave` являются псевдонимами для переходов `void => *` и `* => void`.
Эти псевдонимы используются несколькими функциями анимации.

<docs-code hideCopy language="typescript">

transition ( ':enter', [ … ] ); // псевдоним для void => _
transition ( ':leave', [ … ] ); // псевдоним для _ => void

</docs-code>

Сложнее нацелиться на элемент, который входит в представление, потому что его еще нет в DOM.
Используйте псевдонимы `:enter` и `:leave` для нацеливания на HTML-элементы, которые вставляются или удаляются из
представления.

### Использование `*ngIf` и `*ngFor` с :enter и :leave

Переход `:enter` запускается, когда любые представления `*ngIf` или `*ngFor` помещаются на страницу, а `:leave`
запускается, когда эти представления удаляются со страницы.

IMPORTANT: Поведение входа/выхода иногда может сбивать с толку.
Как правило, считайте, что любой элемент, добавляемый в DOM Angular'ом, проходит через переход `:enter`. Только
элементы, непосредственно удаляемые из DOM Angular'ом, проходят через переход `:leave`. Например, представление элемента
удаляется из DOM, потому что его родитель удаляется из DOM.

В этом примере есть специальный триггер для анимации входа и выхода под названием `myInsertRemoveTrigger`.
HTML-шаблон содержит следующий код.

<docs-code header="insert-remove.component.html" path="adev/src/content/examples/animations/src/app/insert-remove.component.html" region="insert-remove"/>

В файле компонента переход `:enter` устанавливает начальную непрозрачность (opacity) равной 0. Затем он анимирует её
изменение до 1 по мере вставки элемента в представление.

<docs-code header="insert-remove.component.ts" path="adev/src/content/examples/animations/src/app/insert-remove.component.ts" region="enter-leave-trigger"/>

Обратите внимание, что в этом примере не нужно использовать [`state()`](api/animations/state).

## Переходы :increment и :decrement

Функция `transition()` принимает другие значения селектора: `:increment` и `:decrement`.
Используйте их, чтобы запустить переход, когда числовое значение увеличилось или уменьшилось.

HELPFUL: В следующем примере используются методы `query()` и `stagger()`.
Для получения дополнительной информации об этих методах см.
страницу [сложные последовательности](guide/legacy-animations/complex-sequences).

<docs-code header="hero-list-page.component.ts" path="adev/src/content/examples/animations/src/app/hero-list-page.component.ts" region="increment"/>

## Булевы значения в переходах

Если триггер содержит булево значение в качестве значения привязки, то это значение можно сопоставить с помощью
выражения `transition()`, которое сравнивает `true` и `false` или `1` и `0`.

<docs-code header="open-close.component.html" path="adev/src/content/examples/animations/src/app/open-close.component.2.html" region="trigger-boolean"/>

В приведенном выше фрагменте кода HTML-шаблон связывает элемент `<div>` с триггером с именем `openClose` с выражением
статуса `isOpen` и возможными значениями `true` и `false`.
Этот паттерн является альтернативой практике создания двух именованных состояний, таких как `open` и `close`.

Внутри метаданных `@Component` в свойстве `animations:`, когда состояние оценивается как `true`, высота связанного
HTML-элемента становится стилем подстановочного знака или значением по умолчанию.
В этом случае анимация использует любую высоту, которую элемент имел до начала анимации.
Когда элемент `closed` (значение `false`), он анимируется до высоты 0, что делает его невидимым.

<docs-code header="open-close.component.ts" path="adev/src/content/examples/animations/src/app/open-close.component.2.ts" region="trigger-boolean"/>

## Несколько триггеров анимации

Вы можете определить более одного триггера анимации для компонента.
Прикрепите триггеры анимации к разным элементам, и отношения родитель-потомок между элементами будут влиять на то, как и
когда запускаются анимации.

### Анимации родитель-потомок

Каждый раз, когда в Angular запускается анимация, родительская анимация всегда получает приоритет, а дочерние анимации
блокируются.
Чтобы дочерняя анимация запустилась, родительская анимация должна запросить каждый из элементов, содержащих дочерние
анимации. Затем она позволяет анимациям запуститься с помощью функции [`animateChild()`](api/animations/animateChild).

#### Отключение анимации на HTML-элементе

Специальная привязка управления анимацией `@.disabled` может быть размещена на HTML-элементе для отключения анимации на
этом элементе, а также на любых вложенных элементах.
Когда значение истинно, привязка `@.disabled` предотвращает рендеринг всех анимаций.

Следующий пример кода показывает, как использовать эту функцию.

<docs-code-multifile>
    <docs-code header="open-close.component.html" path="adev/src/content/examples/animations/src/app/open-close.component.4.html" region="toggle-animation"/>
    <docs-code header="open-close.component.ts" path="adev/src/content/examples/animations/src/app/open-close.component.4.ts" region="toggle-animation" language="typescript"/>
</docs-code-multifile>

Когда привязка `@.disabled` истинна, триггер `@childAnimation` не срабатывает.

Когда у элемента внутри HTML-шаблона анимация отключена с помощью хост-привязки `@.disabled`, анимация отключается и на
всех внутренних элементах.
Вы не можете выборочно отключить несколько анимаций на одном элементе.<!-- vale off -->

Выборочные дочерние анимации все же могут быть запущены на отключенном родителе одним из следующих способов:

- Родительская анимация может использовать функцию [`query()`](api/animations/query) для сбора внутренних элементов,
расположенных в отключенных областях HTML-шаблона.
Эти элементы все еще могут анимироваться.
<!-- vale on -->

- Дочерняя анимация может быть запрошена родителем, а затем анимирована с помощью функции `animateChild()`.

#### Отключение всех анимаций

Чтобы отключить все анимации для приложения Angular, поместите хост-привязку `@.disabled` на самый верхний компонент
Angular.

<docs-code header="app.component.ts" path="adev/src/content/examples/animations/src/app/app.component.ts" region="toggle-app-animations"/>

HELPFUL: Отключение анимации во всем приложении полезно во время сквозного \(E2E\) тестирования.

## Коллбэки анимации

Функция анимации `trigger()` генерирует _коллбэки_ (обратные вызовы) при запуске и при завершении.
В следующем примере представлен компонент, содержащий триггер `openClose`.

<docs-code header="open-close.component.ts" path="adev/src/content/examples/animations/src/app/open-close.component.ts" region="events1"/>

В HTML-шаблоне событие анимации передается обратно через `$event` как `@triggerName.start` и `@triggerName.done`, где
`triggerName` — это имя используемого триггера.
В этом примере триггер `openClose` выглядит следующим образом.

<docs-code header="open-close.component.html" path="adev/src/content/examples/animations/src/app/open-close.component.3.html" region="callbacks"/>

Потенциальным применением коллбэков анимации может быть маскировка медленного вызова API, например, поиска в базе
данных.
Например, кнопка **InProgress** может быть настроена на собственную циклическую анимацию, пока завершается операция
бэкенд-системы.

Другая анимация может быть вызвана, когда текущая анимация завершится.
Например, кнопка переходит из состояния `inProgress` в состояние `closed`, когда вызов API завершен.

Анимация может повлиять на восприятие конечным пользователем операции как более быстрой, даже если это не так.

Коллбэки могут служить инструментом отладки, например, в сочетании с `console.warn()` для просмотра прогресса приложения
в консоли разработчика браузера.
Следующий фрагмент кода создает вывод в лог консоли для исходного примера — кнопки с двумя состояниями `open` и
`closed`.

<docs-code header="open-close.component.ts" path="adev/src/content/examples/animations/src/app/open-close.component.ts" region="events"/>

## Ключевые кадры (Keyframes)

Чтобы создать анимацию с несколькими шагами, выполняемыми последовательно, используйте _ключевые кадры_.

Функция Angular `keyframe()` позволяет выполнять несколько изменений стиля в рамках одного временного сегмента.
Например, кнопка вместо плавного исчезновения может менять цвет несколько раз в течение одного 2-секундного промежутка
времени.

<img alt="keyframes" src="assets/images/guide/animations/keyframes-500.png">

Код для этого изменения цвета может выглядеть так.

<docs-code header="status-slider.component.ts" path="adev/src/content/examples/animations/src/app/status-slider.component.ts" region="keyframes"/>

### Смещение (Offset)

Ключевые кадры включают `offset` (смещение), которое определяет точку в анимации, где происходит каждое изменение стиля.
Смещения — это относительные меры от нуля до единицы, отмечающие начало и конец анимации. Они должны применяться к
каждому шагу ключевого кадра, если используются хотя бы один раз.

Определение смещений для ключевых кадров необязательно.
Если вы их опустите, будут автоматически назначены равномерно распределенные смещения.
Например, три ключевых кадра без предопределенных смещений получат смещения 0, 0.5 и 1.
Указание смещения 0.8 для среднего перехода в предыдущем примере может выглядеть так.

<img alt="keyframes with offset" src="assets/images/guide/animations/keyframes-offset-500.png">

Код с указанными смещениями будет следующим.

<docs-code header="status-slider.component.ts" path="adev/src/content/examples/animations/src/app/status-slider.component.ts" region="keyframesWithOffsets"/>

Вы можете комбинировать ключевые кадры с `duration`, `delay` и `easing` в рамках одной анимации.

### Ключевые кадры с пульсацией

Используйте ключевые кадры для создания эффекта пульсации в ваших анимациях, определяя стили при определенном смещении
на протяжении всей анимации.

Вот пример использования ключевых кадров для создания эффекта пульсации:

- Исходные состояния `open` и `closed` с оригинальными изменениями высоты, цвета и непрозрачности, происходящими в
  течение 1 секунды.
- Последовательность ключевых кадров, вставленная в середину, которая заставляет кнопку казаться нерегулярно
  пульсирующей в течение того же 1-секундного периода.

<img alt="keyframes with irregular pulsation" src="assets/images/guide/animations/keyframes-pulsation.png">

Фрагмент кода для этой анимации может выглядеть так.

<docs-code header="open-close.component.ts" path="adev/src/content/examples/animations/src/app/open-close.component.1.ts" region="trigger"/>

### Анимируемые свойства и единицы измерения

Поддержка анимации в Angular построена поверх веб-анимаций, поэтому вы можете анимировать любое свойство, которое
браузер считает анимируемым.
Сюда входят позиции, размеры, трансформации, цвета, границы и многое другое.
W3C поддерживает список анимируемых свойств на своей
странице [CSS Transitions](https://www.w3.org/TR/css-transitions-1).

Для свойств с числовым значением определите единицу измерения, предоставив значение в виде строки в кавычках с
соответствующим суффиксом:

- 50 пикселей:
  `'50px'`

- Относительный размер шрифта:
  `'3em'`

- Проценты:
  `'100%'`

Вы также можете предоставить значение в виде числа. В таких случаях Angular предполагает единицу измерения по
умолчанию — пиксели или `px`.
Выражение 50 пикселей как `50` равносильно `'50px'`.

HELPFUL: Строка `"50"` не будет считаться допустимой\).

### Автоматическое вычисление свойств с помощью подстановочных знаков

Иногда значение размерного свойства стиля неизвестно до времени выполнения.
Например, элементы часто имеют ширину и высоту, зависящие от их содержимого или размера экрана.
Эти свойства часто сложно анимировать с помощью CSS.

В этих случаях вы можете использовать специальное значение свойства подстановочного знака `*` в `style()`. Значение
этого конкретного свойства стиля вычисляется во время выполнения и затем подставляется в анимацию.

В следующем примере есть триггер под названием `shrinkOut`, используемый, когда HTML-элемент покидает страницу.
Анимация берет любую высоту, которую элемент имеет перед уходом, и анимирует её от этой высоты до нуля.

<docs-code header="hero-list-auto.component.ts" path="adev/src/content/examples/animations/src/app/hero-list-auto.component.ts" region="auto-calc"/>

### Кратко о ключевых кадрах

Функция `keyframes()` в Angular позволяет указать несколько промежуточных стилей в рамках одного перехода.
Необязательный `offset` может использоваться для определения точки в анимации, где должно произойти каждое изменение
стиля.

## Подробнее об анимации в Angular

Вас также может заинтересовать следующее:

<docs-pill-row>
  <docs-pill href="guide/legacy-animations" title="Введение в анимацию Angular"/>
  <docs-pill href="guide/legacy-animations/complex-sequences" title="Сложные последовательности анимации"/>
  <docs-pill href="guide/legacy-animations/reusable-animations" title="Повторно используемые анимации"/>
  <docs-pill href="guide/routing/route-transition-animations" title="Анимация переходов маршрутов"/>
  <docs-pill href="guide/animations/migration" title="Миграция на нативные CSS-анимации"/>
</docs-pill-row>
