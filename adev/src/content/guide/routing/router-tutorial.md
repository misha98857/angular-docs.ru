# Использование маршрутов Angular в одностраничном приложении (SPA)

В этом руководстве описывается, как создать одностраничное приложение (SPA), использующее несколько маршрутов Angular.

В одностраничном приложении (SPA) все функции вашего приложения находятся на одной HTML-странице.
Когда пользователи обращаются к функциям приложения, браузеру нужно рендерить только те части, которые важны для
пользователя, вместо загрузки новой страницы.
Этот паттерн может значительно улучшить пользовательский опыт (UX) вашего приложения.

Для определения того, как пользователи перемещаются по приложению, используются маршруты (routes).
Добавьте маршруты, чтобы определить навигацию пользователей из одной части приложения в другую.
Вы также можете настроить маршруты для защиты от неожиданного или несанкционированного поведения.

## Цели

- Организация функций примера приложения в модули.
- Определение способа навигации к компоненту.
- Передача информации компоненту с использованием параметра.
- Структурирование маршрутов путем вложения нескольких маршрутов.
- Проверка того, могут ли пользователи получить доступ к маршруту.
- Контроль того, может ли приложение отменить несохраненные изменения.
- Улучшение производительности за счет предварительной выборки данных маршрута и ленивой загрузки функциональных
  модулей.
- Требование определенных критериев для загрузки компонентов.

## Создание примера приложения

Используя Angular CLI, создайте новое приложение _angular-router-sample_.
В этом приложении будет два компонента: _crisis-list_ и _heroes-list_.

1. Создайте новый проект Angular, _angular-router-sample_.

   ```shell
   ng new angular-router-sample
   ```

   При запросе `Would you like to add Angular routing?` выберите `N`.

   При запросе `Which stylesheet format would you like to use?` выберите `CSS`.

   Через несколько мгновений новый проект `angular-router-sample` будет готов.

1. В терминале перейдите в директорию `angular-router-sample`.
1. Создайте компонент _crisis-list_.

```shell
ng generate component crisis-list
```

1. В редакторе кода найдите файл `crisis-list.component.html` и замените содержимое заполнителя следующим HTML.

<docs-code header="crisis-list.component.html" path="adev/src/content/examples/router-tutorial/src/app/crisis-list/crisis-list.component.html"/>

1. Создайте второй компонент, _heroes-list_.

```shell
ng generate component heroes-list
```

1. В редакторе кода найдите файл `heroes-list.component.html` и замените содержимое заполнителя следующим HTML.

<docs-code header="heroes-list.component.html" path="adev/src/content/examples/router-tutorial/src/app/heroes-list/heroes-list.component.html"/>

1. В редакторе кода откройте файл `app.component.html` и замените его содержимое следующим HTML.

<docs-code header="app.component.html" path="adev/src/content/examples/router-tutorial/src/app/app.component.html" visibleRegion="setup"/>

1. Убедитесь, что новое приложение работает должным образом, выполнив команду `ng serve`.

```shell
ng serve
```

1. Откройте браузер по адресу `http://localhost:4200`.

   Вы должны увидеть одну веб-страницу, состоящую из заголовка и HTML двух ваших компонентов.

## Определение маршрутов

В этом разделе вы определите два маршрута:

- Маршрут `/crisis-center` открывает компонент `crisis-center`.
- Маршрут `/heroes-list` открывает компонент `heroes-list`.

Определение маршрута — это объект JavaScript.
Каждый маршрут обычно имеет два свойства.
Первое свойство, `path`, — это строка, указывающая путь URL для маршрута.
Второе свойство, `component`, — это строка, указывающая, какой компонент приложение должно отображать для этого пути.

1. В редакторе кода создайте и откройте файл `app.routes.ts`.
1. Создайте и экспортируйте список маршрутов для вашего приложения:

   ```ts
   import {Routes} from '@angular/router';

   export const routes = [];
   ```

1. Добавьте два маршрута для первых двух компонентов:

   ```ts
   {path: 'crisis-list', component: CrisisListComponent},
   {path: 'heroes-list', component: HeroesListComponent},
   ```

Этот список маршрутов представляет собой массив объектов JavaScript, где каждый объект определяет свойства маршрута.

## Импорт `provideRouter` из `@angular/router`

Маршрутизация позволяет отображать определенные представления (views) приложения в зависимости от пути URL.
Чтобы добавить эту функциональность в пример приложения, необходимо обновить файл `app.config.ts`, чтобы использовать
функцию провайдера маршрутизатора `provideRouter`.
Вы импортируете эту функцию провайдера из `@angular/router`.

1. В редакторе кода откройте файл `app.config.ts`.
1. Добавьте следующие инструкции импорта:

   ```ts
   import { provideRouter } from '@angular/router';
   import { routes } from './app.routes';
   ```

1. Обновите провайдеры в `appConfig`:

   ```ts
   providers: [provideRouter(routes)]
   ```

Для приложений на основе `NgModule` поместите `provideRouter` в список `providers` модуля `AppModule` или любого другого
модуля, который передается в `bootstrapModule` в приложении.

## Обновление компонента с помощью `router-outlet`

На данный момент вы определили два маршрута для вашего приложения.
Однако в вашем приложении компоненты `crisis-list` и `heroes-list` все еще жестко закодированы в шаблоне
`app.component.html`.
Чтобы маршруты работали, необходимо обновить шаблон для динамической загрузки компонента на основе пути URL.

Чтобы реализовать эту функциональность, добавьте директиву `router-outlet` в файл шаблона.

1. В редакторе кода откройте файл `app.component.html`.
1. Удалите следующие строки.

<docs-code header="app.component.html" path="adev/src/content/examples/router-tutorial/src/app/app.component.html" visibleRegion="components"/>

1. Добавьте директиву `router-outlet`.

<docs-code header="app.component.html" path="adev/src/content/examples/router-tutorial/src/app/app.component.html" visibleRegion="router-outlet"/>

1. Добавьте `RouterOutlet` в импорты `AppComponent` в `app.component.ts`

   ```ts
   imports: [RouterOutlet],
   ```

Посмотрите на обновленное приложение в браузере.
Вы должны увидеть только заголовок приложения.
Чтобы увидеть компонент `crisis-list`, добавьте `crisis-list` в конец пути в адресной строке браузера.
Например:

<docs-code language="http">
http://localhost:4200/crisis-list
</docs-code>

Обратите внимание, что отображается компонент `crisis-list`.
Angular использует определенный вами маршрут для динамической загрузки компонента.
Вы можете загрузить компонент `heroes-list` таким же образом:

<docs-code language="http">
http://localhost:4200/heroes-list
</docs-code>

## Управление навигацией с помощью элементов UI

В настоящее время ваше приложение поддерживает два маршрута.
Однако единственный способ использовать эти маршруты — вручную ввести путь в адресной строке браузера.
В этом разделе вы добавите две ссылки, на которые пользователи могут нажимать для навигации между компонентами
`heroes-list` и `crisis-list`.
Вы также добавите некоторые стили CSS.
Хотя эти стили не являются обязательными, они облегчают идентификацию ссылки для текущего отображаемого компонента.
Вы добавите эту функциональность в следующем разделе.

1. Откройте файл `app.component.html` и добавьте следующий HTML под заголовком.

   <docs-code header="app.component.html" path="adev/src/content/examples/router-tutorial/src/app/app.component.html" visibleRegion="nav"/>

   Этот HTML использует директиву Angular `routerLink`.
   Эта директива связывает определенные вами маршруты с файлами шаблонов.

1. Добавьте директиву `RouterLink` в список импорта `AppComponent` в `app.component.ts`.

1. Откройте файл `app.component.css` и добавьте следующие стили.

<docs-code header="app.component.css" path="adev/src/content/examples/router-tutorial/src/app/app.component.css"/>

Если вы посмотрите приложение в браузере, вы должны увидеть эти две ссылки.
При нажатии на ссылку появляется соответствующий компонент.

## Идентификация активного маршрута

Хотя пользователи могут перемещаться по приложению с помощью ссылок, добавленных в предыдущем разделе, у них нет
простого способа определить, какой маршрут является активным.
Добавьте эту функциональность с помощью директивы Angular `routerLinkActive`.

1. В редакторе кода откройте файл `app.component.html`.
1. Обновите теги ссылок (anchor tags), включив в них директиву `routerLinkActive`.

<docs-code header="app.component.html" path="adev/src/content/examples/router-tutorial/src/app/app.component.html" visibleRegion="routeractivelink"/>

1. Добавьте директиву `RouterLinkActive` в список `imports` компонента `AppComponent` в `app.component.ts`.

Снова посмотрите на приложение.
При нажатии одной из кнопок стиль этой кнопки обновляется автоматически, указывая пользователю на активный компонент.
Добавляя директиву `routerLinkActive`, вы сообщаете приложению о необходимости применить определенный CSS-класс к
активному маршруту.
В этом руководстве это класс `activebutton`, но вы можете использовать любой класс, который захотите.

Обратите внимание, что мы также указываем значение для свойства `ariaCurrentWhenActive` директивы `routerLinkActive`.
Это гарантирует, что пользователи с нарушениями зрения (которые могут не воспринимать различное визуальное оформление)
также смогут определить активную кнопку. Для получения дополнительной информации см.
раздел [Идентификация активных ссылок](/best-practices/a11y#active-links-identification) в рекомендациях по доступности.

## Добавление перенаправления (redirect)

На этом шаге руководства вы добавите маршрут, который перенаправляет пользователя для отображения компонента
`/heroes-list`.

1. В редакторе кода откройте файл `app.routes.ts`.
1. Обновите раздел `routes` следующим образом.

   ```ts
   {path: '', redirectTo: '/heroes-list', pathMatch: 'full'},
   ```

   Обратите внимание, что этот новый маршрут использует пустую строку в качестве пути.
   Кроме того, он заменяет свойство `component` двумя новыми:

   | Свойства     | Детали                                                                                                                                                                                                                                                                                                              |
   | :----------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
   | `redirectTo` | Это свойство указывает Angular перенаправлять с пустого пути на путь `heroes-list`.                                                                                                                                                                                                                                 |
   | `pathMatch`  | Это свойство указывает Angular, какую часть URL нужно сопоставить. Для этого руководства следует установить это свойство в `full`. Эта стратегия рекомендуется, когда у вас пустая строка в качестве пути. Для получения дополнительной информации об этом свойстве см. [документацию Route API](api/router/Route). |

Теперь, когда вы открываете приложение, оно по умолчанию отображает компонент `heroes-list`.

## Добавление страницы 404

Пользователь может попытаться получить доступ к маршруту, который вы не определили.
Чтобы учесть это поведение, рекомендуется отображать страницу 404.
В этом разделе вы создадите страницу 404 и обновите конфигурацию маршрутов, чтобы показывать эту страницу для любых
неуказанных маршрутов.

1. В терминале создайте новый компонент `PageNotFound`.

```shell
ng generate component page-not-found
```

1. В редакторе кода откройте файл `page-not-found.component.html` и замените его содержимое следующим HTML.

<docs-code header="page-not-found/page-not-found.component.html" path="adev/src/content/examples/router-tutorial/src/app/page-not-found/page-not-found.component.html"/>

1. Откройте файл `app.routes.ts` и добавьте следующий маршрут в список маршрутов:

   ```ts
   {path: '**', component: PageNotFoundComponent}
   ```

   Новый маршрут использует путь `**`.
   Так Angular идентифицирует подстановочный (wildcard) маршрут.
   Любой маршрут, который не соответствует существующему маршруту в вашей конфигурации, будет использовать этот маршрут.

ВАЖНО: Обратите внимание, что подстановочный маршрут помещен в конец массива.
Порядок маршрутов важен, так как Angular применяет маршруты по порядку и использует первое найденное совпадение.

Попробуйте перейти к несуществующему маршруту в вашем приложении, например `http://localhost:4200/powers`.
Этот маршрут не соответствует ничему, определенному в файле `app.routes.ts`.
Однако, поскольку вы определили подстановочный маршрут, приложение автоматически отображает компонент `PageNotFound`.

## Следующие шаги

На данном этапе у вас есть базовое приложение, использующее функцию маршрутизации Angular для изменения видимых
пользователю компонентов в зависимости от URL-адреса.
Вы расширили эти функции, включив перенаправление, а также подстановочный маршрут для отображения пользовательской
страницы 404.

Для получения дополнительной информации о маршрутизации см. следующие темы:

<docs-pill-row>
  <docs-pill href="guide/routing/common-router-tasks" title="Маршрутизация и навигация в приложении"/>
  <docs-pill href="api/router/Router" title="API маршрутизатора"/>
</docs-pill-row>
