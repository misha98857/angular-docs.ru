# Справочник по роутеру

В следующих разделах освещаются основные концепции и терминология роутера.

## События роутера

Во время каждой навигации `Router` генерирует события навигации через свойство `Router.events`.
Эти события показаны в следующей таблице.

| Событие роутера                                           | Подробности                                                                                                                                                                                |
| :-------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| [`NavigationStart`](api/router/NavigationStart)           | Вызывается при начале навигации.                                                                                                                                                           |
| [`RouteConfigLoadStart`](api/router/RouteConfigLoadStart) | Вызывается перед тем, как `Router` лениво загрузит конфигурацию маршрута.                                                                                                                  |
| [`RouteConfigLoadEnd`](api/router/RouteConfigLoadEnd)     | Вызывается после ленивой загрузки маршрута.                                                                                                                                                |
| [`RoutesRecognized`](api/router/RoutesRecognized)         | Вызывается, когда Роутер разбирает URL и маршруты распознаны.                                                                                                                              |
| [`GuardsCheckStart`](api/router/GuardsCheckStart)         | Вызывается, когда Роутер начинает фазу Guards (Защитников).                                                                                                                                |
| [`ChildActivationStart`](api/router/ChildActivationStart) | Вызывается, когда Роутер начинает активацию дочерних элементов маршрута.                                                                                                                   |
| [`ActivationStart`](api/router/ActivationStart)           | Вызывается, когда Роутер начинает активацию маршрута.                                                                                                                                      |
| [`GuardsCheckEnd`](api/router/GuardsCheckEnd)             | Вызывается, когда Роутер успешно завершает фазу Guards.                                                                                                                                    |
| [`ResolveStart`](api/router/ResolveStart)                 | Вызывается, когда Роутер начинает фазу Resolve.                                                                                                                                            |
| [`ResolveEnd`](api/router/ResolveEnd)                     | Вызывается, когда Роутер успешно завершает фазу Resolve.                                                                                                                                   |
| [`ChildActivationEnd`](api/router/ChildActivationEnd)     | Вызывается, когда Роутер завершает активацию дочерних элементов маршрута.                                                                                                                  |
| [`ActivationEnd`](api/router/ActivationEnd)               | Вызывается, когда Роутер завершает активацию маршрута.                                                                                                                                     |
| [`NavigationEnd`](api/router/NavigationEnd)               | Вызывается при успешном завершении навигации.                                                                                                                                              |
| [`NavigationCancel`](api/router/NavigationCancel)         | Вызывается при отмене навигации. Это может произойти, когда Guard маршрута возвращает `false` во время навигации или выполняет перенаправление, возвращая `UrlTree` или `RedirectCommand`. |
| [`NavigationError`](api/router/NavigationError)           | Вызывается, когда навигация не удалась из-за непредвиденной ошибки.                                                                                                                        |
| [`Scroll`](api/router/Scroll)                             | Представляет событие прокрутки.                                                                                                                                                            |

При включении функции `withDebugTracing` Angular выводит эти события в консоль.

## Терминология роутера

Ниже приведены ключевые термины `Router` и их значения:

| Часть роутера            | Подробности                                                                                                                                                                                                                                                 |
| :----------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `Router`                 | Отображает компонент приложения для активного URL. Управляет навигацией от одного компонента к другому.                                                                                                                                                     |
| `provideRouter`          | Предоставляет необходимых провайдеров сервисов для навигации по представлениям приложения.                                                                                                                                                                  |
| `RouterModule`           | Отдельный NgModule, который предоставляет необходимых провайдеров сервисов и директивы для навигации по представлениям приложения.                                                                                                                          |
| `Routes`                 | Определяет массив маршрутов (`Routes`), каждый из которых сопоставляет путь URL с компонентом.                                                                                                                                                              |
| `Route`                  | Определяет, как роутер должен переходить к компоненту на основе шаблона URL. Большинство маршрутов состоят из пути и типа компонента.                                                                                                                       |
| `RouterOutlet`           | Директива \(`<router-outlet>`\), отмечающая место, где роутер отображает представление.                                                                                                                                                                     |
| `RouterLink`             | Директива для привязки кликабельного HTML-элемента к маршруту. Клик по элементу с директивой `routerLink`, привязанной к _строке_ или _массиву параметров ссылки_, запускает навигацию.                                                                     |
| `RouterLinkActive`       | Директива для добавления/удаления классов HTML-элемента, когда связанный `routerLink`, находящийся на элементе или внутри него, становится активным/неактивным. Она также может устанавливать `aria-current` для активной ссылки для улучшения доступности. |
| `ActivatedRoute`         | Сервис, предоставляемый каждому компоненту маршрута, который содержит специфическую для маршрута информацию, такую как параметры маршрута, статические данные, данные resolve, глобальные параметры запроса и глобальный фрагмент.                          |
| `RouterState`            | Текущее состояние роутера, включающее дерево текущих активированных маршрутов вместе со вспомогательными методами для обхода дерева маршрутов.                                                                                                              |
| Массив параметров ссылки | Массив, который роутер интерпретирует как инструкцию по маршрутизации. Вы можете привязать этот массив к `RouterLink` или передать его в качестве аргумента методу `Router.navigate`.                                                                       |
| Компонент маршрутизации  | Компонент Angular с `RouterOutlet`, который отображает представления на основе навигации роутера.                                                                                                                                                           |

## `<base href>`

Роутер
использует [history.pushState](https://developer.mozilla.org/docs/Web/API/History_API/Working_with_the_History_API#adding_and_modifying_history_entries 'HTML5 browser history push-state')
браузера для навигации.
`pushState` позволяет настраивать пути URL внутри приложения; например, `localhost:4200/crisis-center`.
URL-адреса внутри приложения могут быть неотличимы от серверных URL-адресов.

Современные HTML5-браузеры первыми поддержали `pushState`, поэтому многие называют эти URL-адреса URL-адресами в «стиле
HTML5».

ПОЛЕЗНО: Навигация в стиле HTML5 используется роутером по умолчанию.
В разделе [LocationStrategy и стили URL браузера](common-router-tasks#locationstrategy-and-browser-url-styles) узнайте,
почему стиль HTML5 предпочтительнее, как настроить его поведение и как переключиться на старый стиль хеша \(`#`\), если
это необходимо.

Для работы маршрутизации `pushState` необходимо добавить элемент [
`<base href>`](https://developer.mozilla.org/docs/Web/HTML/Element/base 'base href') в файл `index.html` приложения.
Браузер использует значение `<base href>` для добавления префикса к относительным URL-адресам при ссылке на CSS-файлы,
скрипты и изображения.

Добавьте элемент `<base>` сразу после тега `<head>`.
Если папка `app` является корнем приложения, как в данном случае, установите значение `href` в `index.html`, как
показано здесь.

<docs-code header="index.html (base-href)" path="adev/src/content/examples/router/src/index.html" region="base-href"/>

### HTML5 URL и `<base href>`

Приведенные ниже рекомендации относятся к различным частям URL.
На этой диаграмме показано, к чему относятся эти части:

<docs-code hideCopy language="text">
foo://example.com:8042/over/there?name=ferret#nose
\_/   \______________/\_________/ \_________/ \__/
 |           |            |            |        |
scheme    authority      path        query   fragment
</docs-code>

Хотя роутер по умолчанию использует
стиль [HTML5 pushState](https://developer.mozilla.org/docs/Web/API/History_API#Adding_and_modifying_history_entries 'Browser history push-state'),
вы должны настроить эту стратегию с помощью `<base href>`.

Предпочтительный способ настройки стратегии — добавить тег [
`<base href>`](https://developer.mozilla.org/docs/Web/HTML/Element/base 'base href') в `<head>` файла `index.html`.

```angular-html
<base href="/">
```

Без этого тега браузер может не загрузить ресурсы (изображения, CSS, скрипты) при «глубоких ссылках» (deep linking) в
приложение.

Некоторые разработчики не могут добавить элемент `<base>`, возможно, из-за отсутствия доступа к `<head>` или
`index.html`.

Эти разработчики все равно могут использовать URL-адреса HTML5, выполнив следующие два шага:

1. Предоставить роутеру соответствующее значение `APP_BASE_HREF`.
1. Использовать корневые URL-адреса (URL с `authority`) для всех веб-ресурсов: CSS, изображений, скриптов и HTML-файлов
   шаблонов.

- `path` в `<base href>` должен заканчиваться на «/», так как браузеры игнорируют символы в `path`, следующие за самым
  правым «`/`».
- Если `<base href>` включает часть `query`, то `query` используется только в том случае, если `path` ссылки на
  странице пуст и не имеет `query`.
  Это означает, что `query` в `<base href>` включается только при использовании `HashLocationStrategy`.

- Если ссылка на странице является корневым URL (имеет `authority`), то `<base href>` не используется.
  Таким образом, `APP_BASE_HREF` с указанием authority заставит все ссылки, созданные Angular, игнорировать значение
  `<base href>`.

- Фрагмент в `<base href>` _никогда_ не сохраняется.

Для получения более полной информации о том, как `<base href>` используется для создания целевых URI, см.
раздел [RFC](https://tools.ietf.org/html/rfc3986#section-5.2.2) о преобразовании ссылок.

### `HashLocationStrategy`

Используйте `HashLocationStrategy`, передав `useHash: true` в объекте в качестве второго аргумента
`RouterModule.forRoot()` в `AppModule`.

```ts
providers: [
  provideRouter(appRoutes, withHashLocation())
]
```

При использовании `RouterModule.forRoot` это настраивается с помощью `useHash: true` во втором аргументе:
`RouterModule.forRoot(routes, {useHash: true})`.
