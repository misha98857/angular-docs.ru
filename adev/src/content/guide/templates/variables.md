# Переменные в шаблонах

В Angular существует два типа объявления переменных в шаблонах: локальные переменные шаблона и ссылочные переменные
шаблона.

## Локальные переменные шаблона с `@let`

Синтаксис `@let` в Angular позволяет определить локальную переменную и повторно использовать ее в шаблоне,
аналогично [синтаксису
`let` в JavaScript](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/let).

### Использование `@let`

Используйте `@let` для объявления переменной, значение которой основано на результате выражения шаблона. Angular
автоматически поддерживает актуальность значения переменной в соответствии с заданным выражением,
подобно [привязкам](./templates/bindings).

```angular-html
@let name = user.name;
@let greeting = 'Hello, ' + name;
@let data = data$ | async;
@let pi = 3.14159;
@let coordinates = {x: 50, y: 100};
@let longExpression = 'Lorem ipsum dolor sit amet, consectetur adipiscing elit ' +
                      'sed do eiusmod tempor incididunt ut labore et dolore magna ' +
                      'Ut enim ad minim veniam...';
```

Каждый блок `@let` может объявлять ровно одну переменную. Вы не можете объявить несколько переменных в одном блоке через
запятую.

### Ссылка на значение `@let`

После объявления переменной с помощью `@let`, вы можете повторно использовать ее в том же шаблоне:

```angular-html
@let user = user$ | async;

@if (user) {
  <h1>Hello, {{user.name}}</h1>
  <user-avatar [photo]="user.photo"/>

  <ul>
    @for (snack of user.favoriteSnacks; track snack.id) {
      <li>{{snack.name}}</li>
    }
  </ul>

  <button (click)="update(user)">Update profile</button>
}
```

### Присваивание

Ключевое различие между `@let` и `let` в JavaScript заключается в том, что `@let` нельзя переназначить после объявления.
Однако Angular автоматически поддерживает актуальность значения переменной в соответствии с заданным выражением.

```angular-html
@let value = 1;

<!-- Недопустимо - Это не сработает! -->
<button (click)="value = value + 1">Increment the value</button>
```

### Область видимости переменных

Объявления `@let` ограничены текущим представлением (view) и его потомками. Angular создает новое представление на
границах компонентов и везде, где шаблон может содержать динамический контент, например, в блоках потока управления,
блоках `@defer` или структурных директивах.

Так как объявления `@let` не поднимаются (hoisted), к ним **нельзя** получить доступ из родительских представлений или
соседних элементов:

```angular-html
@let topLevel = value;

<div>
  @let insideDiv = value;
</div>

{{topLevel}} <!-- Допустимо -->
{{insideDiv}} <!-- Допустимо -->

@if (condition) {
  {{topLevel + insideDiv}} <!-- Допустимо -->

  @let nested = value;

  @if (condition) {
    {{topLevel + insideDiv + nested}} <!-- Допустимо -->
  }
}

{{nested}} <!-- Ошибка, не поднимается из @if -->
```

### Полный синтаксис

Синтаксис `@let` формально определяется следующим образом:

- Ключевое слово `@let`.
- За которым следует один или несколько пробелов, исключая переводы строк.
- За которым следует допустимое имя JavaScript и ноль или более пробелов.
- За которым следует символ = и ноль или более пробелов.
- За которым следует выражение Angular, которое может быть многострочным.
- Завершается символом `;`.

## Ссылочные переменные шаблона

Ссылочные переменные шаблона позволяют объявить переменную, которая ссылается на значение элемента в вашем шаблоне.

Ссылочная переменная шаблона может ссылаться на следующее:

- DOM-элемент внутри шаблона (
  включая [пользовательские элементы](https://developer.mozilla.org/en-US/docs/Web/API/Web_components/Using_custom_elements))
- компонент или директиву Angular
- [TemplateRef](/api/core/TemplateRef) из [ng-template](/api/core/ng-template)

Вы можете использовать ссылочные переменные шаблона для чтения информации из одной части шаблона в другой части того же
шаблона.

### Объявление ссылочной переменной шаблона

Вы можете объявить переменную на элементе в шаблоне, добавив атрибут, начинающийся с символа решетки (`#`), за которым
следует имя переменной.

```angular-html
<!-- Создание ссылочной переменной шаблона с именем "taskInput", ссылающейся на HTMLInputElement. -->
<input #taskInput placeholder="Enter task name">
```

### Присваивание значений ссылочным переменным шаблона

Angular присваивает значение переменным шаблона в зависимости от элемента, на котором объявлена переменная.

Если вы объявляете переменную на компоненте Angular, переменная ссылается на экземпляр компонента.

```angular-html
<!-- Переменной `startDate` присваивается экземпляр `MyDatepicker`. -->
<my-datepicker #startDate />
```

Если вы объявляете переменную на элементе `<ng-template>`, переменная ссылается на экземпляр `TemplateRef`, который
представляет шаблон. Для получения дополнительной информации
см. [Как Angular использует синтаксис звездочки, \*](/guide/directives/structural-directives#structural-directive-shorthand)
в разделе [Структурные директивы](/guide/directives/structural-directives).

```angular-html
<!-- Переменной `myFragment` присваивается экземпляр `TemplateRef`, соответствующий этому фрагменту шаблона. -->
<ng-template #myFragment>
  <p>This is a template fragment</p>
</ng-template>
```

Если вы объявляете переменную на любом другом отображаемом элементе, переменная ссылается на экземпляр `HTMLElement`.

```angular-html
<!-- Переменная "taskInput" ссылается на экземпляр HTMLInputElement. -->
<input #taskInput placeholder="Enter task name">
```

#### Присваивание ссылки на директиву Angular

Директивы Angular могут иметь свойство `exportAs`, которое определяет имя, по которому на директиву можно ссылаться в
шаблоне:

```angular-ts
@Directive({
  selector: '[dropZone]',
  exportAs: 'dropZone',
})
export class DropZone { /* ... */ }
```

Когда вы объявляете переменную шаблона на элементе, вы можете присвоить этой переменной экземпляр директивы, указав это
имя `exportAs`:

```angular-html
<!-- Переменная `firstZone` ссылается на экземпляр директивы `DropZone`. -->
<section dropZone #firstZone="dropZone"> ... </section>
```

Вы не можете ссылаться на директиву, которая не указывает имя `exportAs`.

### Использование ссылочных переменных шаблона с запросами

Помимо использования переменных шаблона для чтения значений из другой части того же шаблона, вы также можете
использовать этот стиль объявления переменных, чтобы «пометить» элемент
для [запросов компонентов и директив](/guide/components/queries).

Если вы хотите запросить конкретный элемент в шаблоне, вы можете объявить переменную шаблона на этом элементе, а затем
запросить элемент по имени переменной.

```angular-html
 <input #description value="Original description">
```

```angular-ts
@Component({
  /* ... */,
  template: `<input #description value="Original description">`,
})
export class AppComponent {
  // Запрос элемента input на основе имени переменной шаблона.
  @ViewChild('description') input: ElementRef | undefined;
}
```

См. [Ссылка на дочерние элементы с помощью запросов](/guide/components/queries) для получения дополнительной информации
о запросах.
