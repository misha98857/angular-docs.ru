# Создание динамических форм

Многие формы, такие как анкеты, могут быть очень похожи друг на друга по формату и назначению.
Чтобы быстрее и проще создавать различные версии таких форм, вы можете создать _шаблон динамической формы_ на основе
метаданных, описывающих бизнес-модель объекта.
Затем используйте этот шаблон для автоматической генерации новых форм в соответствии с изменениями в модели данных.

Эта техника особенно полезна, когда у вас есть тип формы, содержание которой должно часто меняться в соответствии с
быстро меняющимися бизнес-требованиями и нормативными актами.
Типичный пример использования — анкета.
Вам может понадобиться получать данные от пользователей в разных контекстах.
Формат и стиль форм, которые видит пользователь, должны оставаться неизменными, в то время как сами вопросы меняются в
зависимости от контекста.

В этом руководстве вы создадите динамическую форму, представляющую собой простую анкету.
Вы создадите онлайн-приложение для героев, ищущих работу.
Агентство постоянно вносит изменения в процесс подачи заявок, но, используя динамическую форму, вы сможете создавать
новые формы на лету, не изменяя код приложения.

Руководство проведет вас через следующие шаги:

1. Включение реактивных форм в проекте.
2. Создание модели данных для представления элементов управления формы.
3. Заполнение модели примерами данных.
4. Разработка компонента для динамического создания элементов управления формы.

Форма, которую вы создадите, использует валидацию ввода и стилизацию для улучшения пользовательского опыта.
У нее есть кнопка отправки, которая активна только тогда, когда все введенные пользователем данные валидны, а
недопустимый ввод помечается цветом и сообщениями об ошибках.

Базовая версия может развиваться для поддержки большего разнообразия вопросов, более изящного рендеринга и лучшего
пользовательского опыта.

## Включение реактивных форм в проекте

Динамические формы основаны на реактивных формах.

Чтобы предоставить приложению доступ к директивам реактивных форм, импортируйте `ReactiveFormsModule` из библиотеки
`@angular/forms` в необходимые компоненты.

<docs-code-multifile>
    <docs-code header="dynamic-form.component.ts" path="adev/src/content/examples/dynamic-form/src/app/dynamic-form.component.ts"/>
    <docs-code header="dynamic-form-question.component.ts" path="adev/src/content/examples/dynamic-form/src/app/dynamic-form-question.component.ts"/>
</docs-code-multifile>

## Создание объектной модели формы

Динамическая форма требует объектной модели, которая может описать все сценарии, необходимые для функциональности формы.
Пример формы заявки героя представляет собой набор вопросов — то есть каждый элемент управления в форме должен задавать
вопрос и принимать ответ.

Модель данных для этого типа формы должна представлять вопрос.
Пример включает `DynamicFormQuestionComponent`, который определяет вопрос как фундаментальный объект в модели.

Следующий `QuestionBase` является базовым классом для набора элементов управления, которые могут представлять вопрос и
ответ на него в форме.

<docs-code header="question-base.ts" path="adev/src/content/examples/dynamic-form/src/app/question-base.ts"/>

### Определение классов элементов управления

На основе этого базового класса в примере создаются два новых класса, `TextboxQuestion` и `DropdownQuestion`, которые
представляют различные типы элементов управления.
Когда вы будете создавать шаблон формы на следующем шаге, вы создадите экземпляры этих конкретных типов вопросов, чтобы
динамически отобразить соответствующие элементы управления.

Тип элемента управления `TextboxQuestion` представлен в шаблоне формы с использованием элемента `<input>`. Он задает
вопрос и позволяет пользователям вводить данные. Атрибут `type` элемента определяется на основе поля `type`, указанного
в аргументе `options` (например, `text`, `email`, `url`).

<docs-code header="question-textbox.ts" path="adev/src/content/examples/dynamic-form/src/app/question-textbox.ts"/>

Тип элемента управления `DropdownQuestion` представляет список вариантов в выпадающем списке (select box).

 <docs-code header="question-dropdown.ts" path="adev/src/content/examples/dynamic-form/src/app/question-dropdown.ts"/>

### Компоновка групп форм

Динамическая форма использует сервис для создания сгруппированных наборов элементов ввода на основе модели формы.
Следующий `QuestionControlService` собирает набор экземпляров `FormGroup`, которые используют метаданные из модели
вопросов.
Вы можете указать значения по умолчанию и правила валидации.

<docs-code header="question-control.service.ts" path="adev/src/content/examples/dynamic-form/src/app/question-control.service.ts"/>

## Компоновка содержимого динамической формы

Сама динамическая форма представлена компонентом-контейнером, который вы добавите на более позднем этапе.
Каждый вопрос представлен в шаблоне компонента формы тегом `<app-question>`, который соответствует экземпляру
`DynamicFormQuestionComponent`.

`DynamicFormQuestionComponent` отвечает за рендеринг деталей отдельного вопроса на основе значений в объекте вопроса,
связанном с данными.
Форма полагается на [директиву `[formGroup]`](api/forms/FormGroupDirective 'API reference') для связи HTML-шаблона с
базовыми объектами управления.
`DynamicFormQuestionComponent` создает группы форм и заполняет их элементами управления, определенными в модели вопроса,
указывая правила отображения и валидации.

<docs-code-multifile>
  <docs-code header="dynamic-form-question.component.html" path="adev/src/content/examples/dynamic-form/src/app/dynamic-form-question.component.html"/>
  <docs-code header="dynamic-form-question.component.ts" path="adev/src/content/examples/dynamic-form/src/app/dynamic-form-question.component.ts"/>
</docs-code-multifile>

Цель `DynamicFormQuestionComponent` — представить типы вопросов, определенные в вашей модели.
На данный момент у вас есть только два типа вопросов, но можно представить гораздо больше.
Блок `@switch` в шаблоне определяет, какой тип вопроса отображать.
Switch использует директивы с селекторами [
`formControlName`](api/forms/FormControlName 'FormControlName directive API reference') и [
`formGroup`](api/forms/FormGroupDirective 'FormGroupDirective API reference').
Обе директивы определены в `ReactiveFormsModule`.

### Предоставление данных

Необходим еще один сервис для предоставления конкретного набора вопросов, из которых будет строиться индивидуальная
форма.
Для этого упражнения вы создадите `QuestionService`, чтобы предоставить этот массив вопросов из жестко закодированных
примеров данных.
В реальном приложении сервис может получать данные из бэкенд-системы.
Ключевой момент, однако, заключается в том, что вы управляете вопросами анкеты героя полностью через объекты,
возвращаемые из `QuestionService`.
Чтобы поддерживать анкету при изменении требований, вам нужно только добавлять, обновлять и удалять объекты из массива
`questions`.

`QuestionService` предоставляет набор вопросов в виде массива, привязанного к `input()` вопросам.

<docs-code header="question.service.ts" path="adev/src/content/examples/dynamic-form/src/app/question.service.ts"/>

## Создание шаблона динамической формы

Компонент `DynamicFormComponent` является точкой входа и основным контейнером для формы, которая представлена в шаблоне
с использованием `<app-dynamic-form>`.

Компонент `DynamicFormComponent` представляет список вопросов, привязывая каждый из них к элементу `<app-question>`,
который соответствует `DynamicFormQuestionComponent`.

<docs-code-multifile>
    <docs-code header="dynamic-form.component.html" path="adev/src/content/examples/dynamic-form/src/app/dynamic-form.component.html"/>
    <docs-code header="dynamic-form.component.ts" path="adev/src/content/examples/dynamic-form/src/app/dynamic-form.component.ts"/>
</docs-code-multifile>

### Отображение формы

Чтобы отобразить экземпляр динамической формы, шаблон оболочки `AppComponent` передает массив `questions`, возвращаемый
`QuestionService`, компоненту-контейнеру формы `<app-dynamic-form>`.

<docs-code header="app.component.ts" path="adev/src/content/examples/dynamic-form/src/app/app.component.ts"/>

Такое разделение модели и данных позволяет повторно использовать компоненты для любого типа опроса, при условии, что он
совместим с объектной моделью _вопроса_.

### Обеспечение валидности данных

Шаблон формы использует динамическую привязку метаданных для рендеринга формы без каких-либо жестко закодированных
предположений о конкретных вопросах.
Он динамически добавляет как метаданные элемента управления, так и критерии валидации.

Чтобы гарантировать корректный ввод, кнопка _Save_ отключена до тех пор, пока форма не перейдет в валидное состояние.
Когда форма валидна, нажмите _Save_, и приложение отобразит текущие значения формы в виде JSON.

На следующем рисунке показана итоговая форма.

<img alt="Dynamic-Form" src="assets/images/guide/dynamic-form/dynamic-form.png">

## Следующие шаги

<docs-pill-row>
  <docs-pill title="Валидация ввода формы" href="guide/forms/reactive-forms#validating-form-input" />
  <docs-pill title="Руководство по валидации форм" href="guide/forms/form-validation" />
</docs-pill-row>
