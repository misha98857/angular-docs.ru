# Доступность в Angular

Веб используется множеством людей, включая тех, у кого есть нарушения зрения или моторики.
Существуют различные вспомогательные технологии, которые значительно облегчают взаимодействие этих групп пользователей с
веб-приложениями.
Кроме того, разработка приложения с учетом доступности обычно улучшает пользовательский опыт для всех пользователей.

Для углубленного ознакомления с проблемами и методами проектирования доступных приложений изучите курс Google
web.dev [Learn Accessibility](https://web.dev/learn/accessibility/).

На этой странице рассматриваются лучшие практики проектирования приложений Angular, которые хорошо работают для всех
пользователей, включая тех, кто полагается на вспомогательные технологии.

## Атрибуты доступности

<!-- TODO: add link once attribute binding guide is implemented -->

Создание доступных веб-интерфейсов часто включает
установку [атрибутов Accessible Rich Internet Applications \(ARIA\)](https://web.dev/learn/accessibility/aria-html/) для
обеспечения семантического значения там, где оно может отсутствовать.
Используйте синтаксис привязки атрибутов в шаблоне для управления значениями атрибутов, связанных с доступностью.

### ARIA-атрибуты и свойства

При привязке к ARIA-атрибутам в Angular вы можете использовать их напрямую, как и любой другой HTML-атрибут.

```html
<button [aria-label]="myActionLabel">…</button>
```

Статические ARIA-атрибуты работают как обычные HTML-атрибуты.

```html
<button aria-label="Save document">…</button>
```

ПОЛЕЗНО: По соглашению, HTML-атрибуты используют имена в нижнем регистре \(`tabindex`\), а свойства — camelCase \(
`tabIndex`\).

Некоторые паттерны ARIA предоставляют DOM API или входные данные директив, которые принимают структурированные
значения (например, коллекции ссылок на `Element`). В таких случаях используйте стандартную привязку свойств, чтобы
базовая связь оставалась синхронизированной.

```angular-ts
@Component({
  template: `
    <h2 #dialogTitle>Attention</h2>
    <p #dialogDescription>Please review your answers before continuing.</p>

    <section
      role="dialog"
      [ariaLabelledByElements]="[dialogTitle, dialogDescription]">
      <ng-content />
    </section>

`,
})
export class ReviewDialog {}
```

Здесь `[ariaLabelledByElements]` принимает массив элементов, поэтому привязка свойств поддерживает актуальность ссылок
на элементы при каждом изменении данных шаблона.

См. [руководство по привязке](guide/templates/binding#aria-attributes) для получения сводной информации о синтаксисе
ARIA-атрибутов.

## Компоненты пользовательского интерфейса Angular

Библиотека [Angular Material](https://material.angular.dev), поддерживаемая командой Angular, представляет собой набор
повторно используемых компонентов пользовательского интерфейса, нацеленных на полную доступность.
[Component Development Kit (CDK)](https://material.angular.dev/cdk/categories) включает пакет `a11y`, предоставляющий
инструменты для поддержки различных аспектов доступности.
Например:

- `LiveAnnouncer` используется для озвучивания сообщений пользователям скринридеров с помощью `aria-live` региона.
  См. документацию W3C для получения дополнительной информации
  об [aria-live регионах](https://www.w3.org/WAI/PF/aria-1.1/states_and_properties#aria-live).

- Директива `cdkTrapFocus` удерживает фокус клавиши Tab внутри элемента.
  Используйте её для создания доступного интерфейса для таких компонентов, как модальные диалоговые окна, где фокус
  должен быть ограничен.

Полную информацию об этих и других инструментах см.
в [обзоре доступности Angular CDK](https://material.angular.dev/cdk/a11y/overview).

### Расширение нативных элементов

Нативные HTML-элементы содержат несколько стандартных паттернов взаимодействия, важных для доступности.
При создании компонентов Angular следует по возможности повторно использовать эти нативные элементы напрямую, а не
реализовывать заново хорошо поддерживаемое поведение.

Например, вместо создания пользовательского элемента для новой разновидности кнопки, создайте компонент, который
использует селектор атрибута с нативным элементом `<button>`.
Чаще всего это применимо к `<button>` и `<a>`, но может использоваться и со многими другими типами элементов.

Вы можете увидеть примеры этого паттерна в Angular Material:
[`MatButton`](https://github.com/angular/components/blob/main/src/material/button/button.ts#L33C3-L36C5), [
`MatTabNav`](https://github.com/angular/components/blob/main/src/material/tabs/tab-nav-bar/tab-nav-bar.ts#L62) и [
`MatTable`](https://github.com/angular/components/blob/main/src/material/table/table.ts#L40).

### Использование контейнеров для нативных элементов

Иногда использование подходящего нативного элемента требует элемента-контейнера.
Например, нативный элемент `<input>` не может иметь дочерних элементов, поэтому любые пользовательские компоненты ввода
текста должны оборачивать `<input>` дополнительными элементами.
Просто включив `<input>` в шаблон вашего пользовательского компонента, вы лишаете пользователей вашего компонента
возможности устанавливать произвольные свойства и атрибуты для элемента `<input>`.
Вместо этого создайте компонент-контейнер, который использует проекцию контента для включения нативного элемента
управления в API компонента.

В качестве примера этого паттерна можно рассмотреть [
`MatFormField`](https://material.angular.dev/components/form-field/overview).

## Практический пример: Создание пользовательского индикатора выполнения

Следующий пример показывает, как сделать индикатор выполнения доступным, используя привязку к хосту (host binding) для
управления атрибутами, связанными с доступностью.

- Компонент определяет элемент с поддержкой доступности, используя как стандартный HTML-атрибут `role`, так и
  ARIA-атрибуты.
  ARIA-атрибут `aria-valuenow` привязан к входным данным пользователя.
- В шаблоне атрибут `aria-label` гарантирует, что элемент управления доступен для скринридеров.

<docs-code-multifile>
  <docs-code
    path="adev/src/content/examples/accessibility/src/app/progress-bar.component.ts"
    language="ts"
    linenums
    highlight="[12, 20]"/>
  <docs-code
    path="adev/src/content/examples/accessibility/src/app/app.component.html"
    language="html"
    linenums
    highlight="[8, 9]"/>
</docs-code-multifile>

## Маршрутизация

### Управление фокусом после навигации

Отслеживание и управление [фокусом](https://web.dev/learn/accessibility/focus/) в пользовательском интерфейсе является
важным аспектом проектирования доступности.
При использовании маршрутизации Angular вы должны решить, куда переходит фокус страницы после навигации.

Чтобы не полагаться исключительно на визуальные подсказки, необходимо убедиться, что код маршрутизации обновляет фокус
после навигации по страницам.
Используйте событие `NavigationEnd` из сервиса `Router`, чтобы узнать, когда нужно обновить фокус.

Следующий пример показывает, как найти и сфокусировать заголовок основного контента в DOM после навигации.

```ts
router.events.pipe(filter((e) => e instanceof NavigationEnd)).subscribe(() => {
  const mainHeader = document.querySelector('#main-content-header');
  if (mainHeader) {
    mainHeader.focus();
  }
});
```

В реальном приложении элемент, получающий фокус, зависит от конкретной структуры и макета вашего приложения.
Элемент в фокусе должен позволять пользователям немедленно перейти к основному контенту, который только что появился в
поле зрения в результате маршрутизации.
Следует избегать ситуаций, когда фокус возвращается к элементу `body` после смены маршрута.

### Идентификация активных ссылок

CSS-классы, применяемые к активным элементам `RouterLink`, такие как `RouterLinkActive`, предоставляют визуальную
подсказку для идентификации активной ссылки.
К сожалению, визуальная подсказка не помогает слепым или слабовидящим пользователям.
Применение атрибута `aria-current` к элементу может помочь идентифицировать активную ссылку.
Для получения дополнительной информации
см. [Mozilla Developer Network \(MDN\) aria-current](https://developer.mozilla.org/docs/Web/Accessibility/ARIA/Attributes/aria-current).

Директива `RouterLinkActive` предоставляет входное свойство `ariaCurrentWhenActive`, которое устанавливает
`aria-current` в указанное значение, когда ссылка становится активной.

Следующий пример показывает, как применить класс `active-page` к активным ссылкам, а также установить их атрибут
`aria-current` в значение `"page"`, когда они активны:

```angular-html
<nav>
  <a routerLink="home"
      routerLinkActive="active-page"
      ariaCurrentWhenActive="page">
    Home
  </a>
  <a routerLink="about"
      routerLinkActive="active-page"
      ariaCurrentWhenActive="page">
    About
  </a>
  <a routerLink="shop"
      routerLinkActive="active-page"
      ariaCurrentWhenActive="page">
    Shop
  </a>
</nav>
```

<!-- vale Angular.Angular_Spelling = NO -->

## Отложенная загрузка

При использовании блоков `@defer` в Angular для ленивой загрузки контента учитывайте последствия для доступности для
пользователей вспомогательных технологий.
Скринридеры могут не озвучивать автоматически изменения контента при загрузке отложенных компонентов, потенциально
оставляя пользователей в неведении о новом контенте.

Чтобы гарантировать правильное озвучивание изменений отложенного контента, оберните блоки `@defer` в элементы с
соответствующими live-регионами ARIA.
Подробные рекомендации и примеры см.
в [разделе о доступности в руководстве по defer](/guide/templates/defer#keep-accessibility-in-mind).

## Дополнительная информация

- [Accessibility - Google Web Fundamentals](https://developers.google.com/web/fundamentals/accessibility)
- [Спецификация ARIA и практики создания](https://www.w3.org/TR/wai-aria)
- [Material Design - Доступность](https://material.io/design/usability/accessibility.html)
- [Smashing Magazine](https://www.smashingmagazine.com/search/?q=accessibility)
- [Inclusive Components](https://inclusive-components.design)
- [Ресурсы по доступности и примеры кода](https://dequeuniversity.com/resources)
- [W3C - Инициатива по веб-доступности](https://www.w3.org/WAI/people-use-web)
- [Rob Dodson A11ycasts](https://www.youtube.com/watch?v=HtTyRajRuyY)
- [Angular ESLint](https://github.com/angular-eslint/angular-eslint#functionality) предоставляет правила линтинга,
  которые могут помочь убедиться, что ваш код соответствует стандартам доступности.

<!-- vale Angular.Angular_Spelling = YES -->

Книги

<!-- vale Angular.Google_Quotes = NO -->

- "A Web for Everyone: Designing Accessible User Experiences," Sarah Horton и Whitney Quesenbery
- "Inclusive Design Patterns," Heydon Pickering

<!-- vale Angular.Google_Quotes = YES -->
