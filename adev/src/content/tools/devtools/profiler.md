# Профилирование приложения

Вкладка **Profiler** позволяет визуализировать выполнение обнаружения изменений Angular.
Это полезно для определения того, когда и как обнаружение изменений влияет на производительность вашего приложения.

<img src="assets/images/guide/devtools/profiler.png" alt="Скриншот вкладки 'Profiler', на котором написано 'Click the play button to start a new recording, or upload a json file containing profiler data.' (Нажмите кнопку воспроизведения, чтобы начать новую запись, или загрузите json-файл с данными профилировщика). Рядом находится кнопка записи для начала нового профилирования, а также выбор файла для загрузки существующего профиля.">

Вкладка Profiler позволяет начать профилирование текущего приложения или импортировать существующий профиль из
предыдущего запуска.
Чтобы начать профилирование приложения, наведите курсор на круг в левом верхнем углу вкладки **Profiler** и нажмите \*
\*Start recording\*\*.

Во время профилирования Angular DevTools фиксирует события выполнения, такие как обнаружение изменений и выполнение
хуков жизненного цикла.
Взаимодействуйте с приложением, чтобы вызвать обнаружение изменений и сгенерировать данные, которые сможет использовать
Angular DevTools.
Чтобы завершить запись, снова нажмите на круг **Stop recording**.

Вы также можете импортировать существующую запись.
Подробнее об этой функции читайте в разделе [Импорт записи](tools/devtools#import-and-export-recordings).

## Понимание выполнения вашего приложения

После записи или импорта профиля Angular DevTools отображает визуализацию циклов обнаружения изменений.

<img src="assets/images/guide/devtools/default-profiler-view.png" alt="Скриншот вкладки 'Profiler' после записи или загрузки профиля. Отображается гистограмма, иллюстрирующая различные циклы обнаружения изменений, с текстом 'Select a bar to preview a particular change detection cycle' (Выберите столбец для просмотра конкретного цикла обнаружения изменений).">

Каждый столбец в последовательности представляет цикл обнаружения изменений в вашем приложении.
Чем выше столбец, тем дольше приложение выполняло обнаружение изменений в этом цикле.
При выборе столбца DevTools отображает полезную информацию о нем, включая:

- Гистограмму со всеми компонентами и директивами, зафиксированными в этом цикле.
- Сколько времени Angular потратил на обнаружение изменений в этом цикле.
- Оценочную частоту кадров (frame rate), воспринимаемую пользователем (если она ниже 60 кадров в секунду).

<img src="assets/images/guide/devtools/profiler-selected-bar.png" alt="Скриншот вкладки 'Profiler'. Пользователь выбрал один столбец, и в выпадающем меню рядом отображается 'Bar chart', показывая вторую гистограмму под ним. На новой диаграмме два столбца занимают большую часть пространства: один подписан как `TodosComponent`, другой — `NgForOf`. Остальные столбцы достаточно малы, чтобы ими можно было пренебречь.">

## Понимание выполнения компонентов

Гистограмма, отображаемая после клика по циклу обнаружения изменений, показывает детальное представление о том, сколько
времени приложение потратило на выполнение обнаружения изменений в конкретном компоненте или директиве.

Этот пример показывает общее время, затраченное директивой `NgForOf`, и какой метод был в ней вызван.

<img src="assets/images/guide/devtools/directive-details.png" alt="Скриншот вкладки 'Profiler', где выбран столбец `NgForOf`. Справа виден детальный вид `NgForOf`, где указано 'Total time spent: 1.76 ms' (Общее затраченное время: 1.76 мс). Он включает таблицу с ровно одной строкой, перечисляющей `NgForOf` как директиву с методом `ngDoCheck`, который занял 1.76 мс. Также присутствует список с меткой 'Parent Hierarchy' (Иерархия родителей), содержащий родительские компоненты этой директивы.">

## Иерархические представления

<img src="assets/images/guide/devtools/flame-graph-view.png" alt="Скриншот вкладки 'Profiler'. Пользователь выбрал один столбец, и выпадающее меню рядом теперь отображает 'Flame graph', показывая пламенный граф под ним. Граф начинается со строки 'Entire application' и другой строки 'AppComponent'. Ниже строки начинают разбиваться на несколько элементов, начиная с `[RouterOutlet]` и `DemoAppComponent` в третьем ряду. На глубине нескольких слоев одна ячейка подсвечена красным.">

Вы также можете визуализировать выполнение обнаружения изменений в виде пламенного графа (flame graph).

Каждая плитка на графике представляет элемент на экране в определенной позиции дерева рендеринга.
Например, рассмотрим цикл обнаружения изменений, где `LoggedOutUserComponent` удаляется, а на его месте Angular рендерит
`LoggedInUserComponent`. В этом сценарии оба компонента будут отображены в одной плитке.

Ось X представляет полное время, затраченное на рендеринг этого цикла обнаружения изменений.
Ось Y представляет иерархию элементов. Выполнение обнаружения изменений для элемента требует рендеринга его директив и
дочерних компонентов.
Вместе этот график визуализирует, какие компоненты занимают больше всего времени на рендеринг и на что уходит это время.

Каждая плитка окрашена в зависимости от того, сколько времени Angular потратил на нее.
Angular DevTools определяет интенсивность цвета по времени, затраченному относительно плитки, где рендеринг занял больше
всего времени.

При клике на определенную плитку вы увидите подробности о ней на панели справа.
Двойной клик по плитке увеличивает масштаб, чтобы вы могли легче рассмотреть вложенные дочерние элементы.

## Отладка обнаружения изменений и компонентов `OnPush`

Обычно график визуализирует время, затрачиваемое на _рендеринг_ приложения для любого заданного кадра обнаружения
изменений. Однако некоторые компоненты, такие как компоненты `OnPush`, будут перерисовываться только при изменении их
входных свойств. Может быть полезно визуализировать пламенный граф без этих компонентов для конкретных кадров.

Чтобы визуализировать только те компоненты в кадре обнаружения изменений, которые прошли через процесс обнаружения
изменений, установите флажок **Change detection** вверху, над пламенным графом.

Этот вид подсвечивает все компоненты, прошедшие через обнаружение изменений, и отображает серым цветом те, которые не
прошли, например, компоненты `OnPush`, которые не перерисовывались.

<img src="assets/images/guide/devtools/debugging-onpush.png" alt="Скриншот вкладки 'Profiler', отображающий визуализацию цикла обнаружения изменений в виде пламенного графа. Флажок с надписью 'Show only change detection' теперь отмечен. Пламенный граф выглядит очень похоже на предыдущий, однако цвет компонентов изменился с оранжевого на синий. Несколько плиток с меткой `[RouterOutlet]` больше не подсвечены никаким цветом.">

## Импорт и экспорт записей

Нажмите кнопку **Save Profile** в правом верхнем углу записанной сессии профилирования, чтобы экспортировать её в виде
JSON-файла и сохранить на диск.
Позже импортируйте файл в начальном окне профилировщика, нажав на поле ввода **Choose file**.

<img src="assets/images/guide/devtools/save-profile.png" alt="Скриншот вкладки 'Profiler', отображающий циклы обнаружения изменений. С правой стороны видна кнопка 'Save Profile'.">
