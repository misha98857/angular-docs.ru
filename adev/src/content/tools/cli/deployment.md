# Развертывание

Когда вы готовы развернуть ваше Angular-приложение на удаленном сервере, у вас есть различные варианты.

## Автоматическое развертывание с помощью CLI

Команда Angular CLI `ng deploy` выполняет [CLI-билдер](tools/cli/cli-builder) `deploy`, связанный с вашим проектом.
Ряд сторонних билдеров реализует возможности развертывания на различных платформах.
Вы можете добавить любой из них в свой проект с помощью `ng add`.

Когда вы добавляете пакет с возможностью развертывания, он автоматически обновляет конфигурацию вашего рабочего
пространства (файл `angular.json`), добавляя секцию `deploy` для выбранного проекта.
Затем вы можете использовать команду `ng deploy` для развертывания этого проекта.

Например, следующая команда автоматически развертывает проект в [Firebase](https://firebase.google.com/).

```shell

ng add @angular/fire
ng deploy

```

Команда является интерактивной.
В данном случае у вас должен быть аккаунт Firebase (или вы должны его создать) и пройти аутентификацию.
Команда предложит выбрать проект Firebase для развертывания перед сборкой приложения и загрузкой продакшн-ресурсов в
Firebase.

В таблице ниже перечислены инструменты, реализующие функциональность развертывания на различных платформах.
Команда `deploy` для каждого пакета может требовать различных опций командной строки.
Вы можете узнать больше, перейдя по ссылкам, связанным с именами пакетов ниже:

| Развертывание в                                                   | Команда настройки                                                                           |
| :---------------------------------------------------------------- | :------------------------------------------------------------------------------------------ |
| [Firebase hosting](https://firebase.google.com/docs/hosting)      | [`ng add @angular/fire`](https://npmjs.org/package/@angular/fire)                           |
| [Vercel](https://vercel.com/solutions/angular)                    | [`vercel init angular`](https://github.com/vercel/vercel/tree/main/examples/angular)        |
| [Netlify](https://www.netlify.com)                                | [`ng add @netlify-builder/deploy`](https://npmjs.org/package/@netlify-builder/deploy)       |
| [GitHub pages](https://pages.github.com)                          | [`ng add angular-cli-ghpages`](https://npmjs.org/package/angular-cli-ghpages)               |
| [Amazon Cloud S3](https://aws.amazon.com/s3/?nc2=h_ql_prod_st_s3) | [`ng add @jefiozie/ngx-aws-deploy`](https://www.npmjs.com/package/@jefiozie/ngx-aws-deploy) |

Если вы выполняете развертывание на собственный сервер или для вашей любимой облачной платформы нет билдера, вы можете
либо [создать билдер](tools/cli/cli-builder), позволяющий использовать команду `ng deploy`, либо прочитать это
руководство, чтобы узнать, как развернуть приложение вручную.

## Ручное развертывание на удаленный сервер

Чтобы развернуть приложение вручную, создайте продакшн-сборку и скопируйте выходную директорию на веб-сервер или в сеть
доставки контента (CDN).
По умолчанию `ng build` использует конфигурацию `production`.
Если вы настроили свои конфигурации сборки, возможно, вы захотите убедиться, что перед развертыванием
применяются [оптимизации для продакшена](tools/cli/deployment#production-optimizations).

`ng build` по умолчанию выводит артефакты сборки в `dist/my-app/`, однако этот путь можно настроить с помощью опции
`outputPath` в билдере `@angular-devkit/build-angular:browser`.
Скопируйте эту директорию на сервер и настройте его на обслуживание этой директории.

Хотя это минимальное решение для развертывания, существуют определенные требования к серверу для корректной работы
вашего Angular-приложения.

## Конфигурация сервера

В этом разделе рассматриваются изменения, которые может потребоваться внести в конфигурацию сервера для запуска вашего
Angular-приложения.

### Приложения с маршрутизацией должны возвращаться к `index.html`

Angular-приложения с рендерингом на стороне клиента идеально подходят для обслуживания статическим HTML-сервером, так
как весь контент статичен и генерируется во время сборки.

Если приложение использует роутер Angular, вы должны настроить сервер так, чтобы он возвращал главную страницу
приложения (`index.html`), когда запрашивается файл, которого у него нет.

Приложение с маршрутизацией должно поддерживать "глубокие ссылки" (deep links).
_Глубокая ссылка_ — это URL, указывающий путь к компоненту внутри приложения.
Например, `http://my-app.test/users/42` — это _глубокая ссылка_ на страницу с деталями пользователя, отображающую
пользователя с `id` 42.

Проблем не возникает, когда пользователь сначала загружает главную страницу, а затем переходит по этому URL из
запущенного клиента.
Роутер Angular выполняет навигацию _на стороне клиента_ и не запрашивает новую HTML-страницу.

Но клик по глубокой ссылке в электронном письме, ввод её в адресную строку браузера или даже обновление страницы
браузера, находясь на странице с глубокой ссылкой — всё это обрабатывается самим браузером, _вне_ запущенного
приложения.
Браузер делает прямой запрос к серверу по адресу `/users/42`, минуя роутер Angular.

Статический сервер обычно возвращает `index.html`, когда получает запрос на `http://my-app.test/`.
Но большинство серверов по умолчанию отклонят `http://my-app.test/users/42` и вернут ошибку `404 - Not Found`, _если_
они не настроены возвращать `index.html` вместо этого.
Настройте резервный маршрут или страницу 404 на `index.html` для вашего сервера, чтобы Angular загружался для глубоких
ссылок и мог отобразить правильный маршрут.
Некоторые серверы называют это поведение режимом "Single-Page Application" (SPA).

Как только браузер загрузит приложение, роутер Angular прочитает URL, чтобы определить, на какой странице он находится,
и корректно отобразит `/users/42`.

Для "настоящих" страниц 404, таких как `http://my-app.test/does-not-exist`, сервер не требует дополнительной настройки.
[Страницы 404, реализованные в роутере Angular](guide/routing/common-router-tasks#displaying-a-404-page), будут
отображаться корректно.

### Запрос данных с другого сервера (CORS)

Веб-разработчики могут столкнуться с ошибкой [_совместного использования ресурсов между разными
источниками_](https://developer.mozilla.org/docs/Web/HTTP/CORS) (CORS) при выполнении сетевого запроса к серверу,
отличному от хост-сервера приложения.
Браузеры запрещают такие запросы, если сервер явно их не разрешает.

Angular или клиентское приложение ничего не могут сделать с этими ошибками.
_Сервер_ должен быть настроен на прием запросов приложения.
Узнайте о том, как включить CORS для конкретных серверов, на
сайте [enable-cors.org](https://enable-cors.org/server.html 'Enabling CORS server').

## Оптимизации для продакшена

`ng build` использует конфигурацию `production`, если не настроено иное. Эта конфигурация включает следующие функции
оптимизации сборки.

| Функции                                                            | Детали                                                                                              |
| :----------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------- |
| [Ahead-of-Time (AOT) компиляция](tools/cli/aot-compiler)           | Предварительно компилирует шаблоны компонентов Angular.                                             |
| [Режим продакшена](tools/cli/deployment#development-only-features) | Оптимизирует приложение для наилучшей производительности во время выполнения.                       |
| Бандлинг (Сборка)                                                  | Объединяет множество файлов приложения и библиотек в минимальное количество развертываемых файлов.  |
| Минификация                                                        | Удаляет лишние пробелы, комментарии и необязательные токены.                                        |
| Манглинг (Запутывание)                                             | Переименовывает функции, классы и переменные, используя более короткие произвольные идентификаторы. |
| Удаление мертвого кода                                             | Удаляет неиспользуемые модули и код.                                                                |

См. [`ng build`](cli/build) для получения дополнительной информации о параметрах сборки CLI и их влиянии.

### Функции только для разработки

Когда вы запускаете приложение локально с помощью `ng serve`, Angular использует конфигурацию разработки во время
выполнения, которая включает:

- Дополнительные проверки безопасности, такие как обнаружение [`expression-changed-after-checked`](errors/NG0100).
- Более подробные сообщения об ошибках.
- Дополнительные утилиты отладки, такие как глобальная переменная `ng` с [функциями отладки](api#core-global) и
  поддержка [Angular DevTools](tools/devtools).

Эти функции полезны во время разработки, но требуют дополнительного кода в приложении, что нежелательно в продакшене.
Чтобы гарантировать, что эти функции не окажут негативного влияния на размер бандла для конечных пользователей, Angular
CLI удаляет код, предназначенный только для разработки, из бандла при сборке для продакшена.

Сборка вашего приложения с помощью `ng build` по умолчанию использует конфигурацию `production`, которая удаляет эти
функции из выходных данных для оптимального размера бандла.

## `--deploy-url`

`--deploy-url` — это опция командной строки, используемая для указания базового пути для разрешения относительных
URL-адресов для ресурсов, таких как изображения, скрипты и таблицы стилей, во время _компиляции_.

```shell

ng build --deploy-url /my/assets

```

Эффект и назначение `--deploy-url` пересекаются с [`<base href>`](guide/routing/common-router-tasks). Оба могут
использоваться для начальных скриптов, таблиц стилей, ленивых скриптов и CSS-ресурсов.

В отличие от `<base href>`, который может быть определен в одном месте во время выполнения, `--deploy-url` должен быть
жестко закодирован в приложении во время сборки.
По возможности отдавайте предпочтение `<base href>`.
