# Сборка приложений Angular

Вы можете собрать приложение или библиотеку Angular CLI с помощью команды `ng build`.
Она скомпилирует ваш TypeScript-код в JavaScript, а также оптимизирует, соберет в бандл и минифицирует результат
соответствующим образом.

`ng build` выполняет только билдер для цели `build` в проекте по умолчанию, указанном в `angular.json`.
Angular CLI включает четыре билдера, обычно используемых в качестве целей `build`:

| Билдер                                          | Назначение                                                                                                                                                                                                                                                                 |
| ----------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `@angular-devkit/build-angular:application`     | Собирает приложение с клиентским бандлом, Node-сервером и предварительно отрендеренными маршрутами (во время сборки) с помощью [esbuild](https://esbuild.github.io/).                                                                                                      |
| `@angular-devkit/build-angular:browser-esbuild` | Собирает клиентское приложение для использования в браузере с помощью [esbuild](https://esbuild.github.io/). См. [документацию `browser-esbuild`](tools/cli/build-system-migration#manual-migration-to-the-compatibility-builder) для получения дополнительной информации. |
| `@angular-devkit/build-angular:browser`         | Собирает клиентское приложение для использования в браузере с помощью [webpack](https://webpack.js.org/).                                                                                                                                                                  |
| `@angular-devkit/build-angular:ng-packagr`      | Собирает библиотеку Angular, соответствующую [Angular Package Format](tools/libraries/angular-package-format).                                                                                                                                                             |

Приложения, созданные с помощью `ng new`, используют `@angular-devkit/build-angular:application` по умолчанию.
Библиотеки, созданные с помощью `ng generate library`, используют `@angular-devkit/build-angular:ng-packagr` по
умолчанию.

Вы можете определить, какой билдер используется для конкретного проекта, посмотрев цель `build` для этого проекта.

```json
{
  "projects": {
    "my-app": {
      "architect": {
        // `ng build` invokes the Architect target named `build`.
        "build": {
          "builder": "@angular-devkit/build-angular:application",
          …
        },
        "serve": { … }
        "test": { … }
        …
      }
    }
  }
}
```

На этой странице рассматриваются использование и параметры `@angular-devkit/build-angular:application`.

## Выходная директория

Результат этого процесса сборки выводится в директорию (по умолчанию `dist/${PROJECT_NAME}`).

## Настройка бюджетов размера

По мере роста функциональности приложений увеличивается и их размер.
CLI позволяет устанавливать пороговые значения размера в конфигурации, чтобы гарантировать, что части вашего приложения
остаются в определенных вами границах.

Определите границы размера в конфигурационном файле CLI, `angular.json`, в секции `budgets` для
каждого [настроенного окружения](tools/cli/environments).

```json
{
  …
  "configurations": {
    "production": {
      …
      "budgets": [
        {
          "type": "initial",
          "maximumWarning": "250kb",
          "maximumError": "500kb"
        },
      ]
    }
  }
}
```

Вы можете указать бюджеты размера для всего приложения и для конкретных частей.
Каждая запись бюджета настраивает бюджет определенного типа.
Указывайте значения размера в следующих форматах:

| Значение размера | Подробности                                                                        |
| :--------------- | :--------------------------------------------------------------------------------- |
| `123` или `123b` | Размер в байтах.                                                                   |
| `123kb`          | Размер в килобайтах.                                                               |
| `123mb`          | Размер в мегабайтах.                                                               |
| `12%`            | Процент размера относительно базового уровня. (Недопустимо для значений baseline.) |

При настройке бюджета билдер выдает предупреждение или сообщает об ошибке, когда определенная часть приложения достигает
или превышает установленный вами граничный размер.

Каждая запись бюджета представляет собой JSON-объект со следующими свойствами:

| Свойство       | Значение                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| :------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| type           | Тип бюджета. Один из: <table> <thead> <tr> <th> Значение </th> <th> Подробности </th> </tr> </thead> <tbody> <tr> <td> <code>bundle</code> </td> <td> Размер конкретного бандла. </td> </tr> <tr> <td> <code>initial</code> </td> <td> Размер JavaScript и CSS, необходимых для начальной загрузки приложения. По умолчанию предупреждение при 500kb и ошибка при 1mb. </td> </tr> <tr> <td> <code>allScript</code> </td> <td> Размер всех скриптов. </td> </tr> <tr> <td> <code>all</code> </td> <td> Размер всего приложения. </td> </tr> <tr> <td> <code>anyComponentStyle</code> </td> <td> Размер таблицы стилей любого одного компонента. По умолчанию предупреждение при 2kb и ошибка при 4kb. </td> </tr> <tr> <td> <code>anyScript</code> </td> <td> Размер любого одного скрипта. </td> </tr> <tr> <td> <code>any</code> </td> <td> Размер любого файла. </td> </tr> </tbody> </table> |
| name           | Имя бандла (для `type=bundle`).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| baseline       | Базовый размер для сравнения.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| maximumWarning | Максимальный порог для предупреждения относительно базового уровня.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| maximumError   | Максимальный порог для ошибки относительно базового уровня.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| minimumWarning | Минимальный порог для предупреждения относительно базового уровня.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| minimumError   | Минимальный порог для ошибки относительно базового уровня.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| warning        | Порог для предупреждения относительно базового уровня (мин. и макс.).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| error          | Порог для ошибки относительно базового уровня (мин. и макс.).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |

## Настройка зависимостей CommonJS

Всегда отдавайте предпочтение
нативным [ECMAScript-модулям](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/import) (ESM) во
всем приложении и его зависимостях.
ESM — это полностью специфицированный веб-стандарт и функция языка JavaScript с мощной поддержкой статического анализа.
Это делает оптимизацию бандлов более эффективной по сравнению с другими форматами модулей.

Angular CLI также поддерживает импорт зависимостей [CommonJS](https://nodejs.org/api/modules.html) в ваш проект и
автоматически собирает эти зависимости.
Однако модули CommonJS могут помешать сборщикам и минификаторам эффективно оптимизировать эти модули, что приводит к
увеличению размера бандлов.
Для получения дополнительной информации
см. [Как CommonJS увеличивает ваши бандлы](https://web.dev/commonjs-larger-bundles).

Angular CLI выводит предупреждения, если обнаруживает, что ваше браузерное приложение зависит от модулей CommonJS.
Если вы столкнулись с зависимостью CommonJS, попробуйте попросить разработчика добавить поддержку модулей ECMAScript,
внести эту поддержку самостоятельно или использовать альтернативную зависимость, отвечающую вашим потребностям.
Если лучшим вариантом является использование зависимости CommonJS, вы можете отключить эти предупреждения, добавив имя
модуля CommonJS в опцию `allowedCommonJsDependencies` в параметрах `build`, расположенных в `angular.json`.

```json
"build": {
  "builder": "@angular-devkit/build-angular:browser",
  "options": {
     "allowedCommonJsDependencies": [
        "lodash"
     ]
     …
   }
   …
},
```

## Настройка совместимости с браузерами

Angular CLI использует [Browserslist](https://github.com/browserslist/browserslist) для обеспечения совместимости с
различными версиями браузеров.
В зависимости от поддерживаемых браузеров Angular автоматически преобразует определенные функции JavaScript и CSS, чтобы
гарантировать, что собранное приложение не использует функцию, которая не была реализована поддерживаемым браузером.
Однако Angular CLI не будет автоматически добавлять полифилы для восполнения отсутствующих Web API. Используйте опцию
`polyfills` в `angular.json` для добавления полифилов.

По умолчанию Angular CLI использует конфигурацию `browserslist`,
которая [соответствует браузерам, поддерживаемым Angular](reference/versions#browser-support) для текущей мажорной
версии.

Чтобы переопределить внутреннюю конфигурацию, выполните команду [
`ng generate config browserslist`](cli/generate/config), которая генерирует конфигурационный файл `.browserslistrc` в
директории проекта, соответствующий поддерживаемым Angular браузерам.

См. [репозиторий browserslist](https://github.com/browserslist/browserslist) для получения дополнительных примеров того,
как ориентироваться на конкретные браузеры и версии.
Избегайте расширения этого списка на большее количество браузеров. Даже если код вашего приложения совместим с более
широким кругом браузеров, сам Angular может таковым не быть.
Вам следует только _сокращать_ набор браузеров или версий в этом списке.

ПОЛЕЗНО: Используйте [browsersl.ist](https://browsersl.ist) для отображения совместимых браузеров по запросу
`browserslist`.

## Настройка Tailwind

Angular поддерживает [Tailwind CSS](https://tailwindcss.com/), CSS-фреймворк, ориентированный на утилитарные классы.

Чтобы интегрировать Tailwind CSS с Angular CLI, см. [Использование Tailwind CSS с Angular](guide/tailwind).

## Встраивание критического CSS

Angular может встраивать (inline) определения критического CSS вашего приложения для
улучшения [First Contentful Paint (FCP)](https://web.dev/first-contentful-paint).
Эта опция включена по умолчанию. Вы можете отключить это встраивание в [параметрах настройки
`styles`](reference/configs/workspace-config#styles-optimization-options).

Эта оптимизация извлекает CSS, необходимый для рендеринга начальной области просмотра, и встраивает его непосредственно
в сгенерированный HTML, позволяя браузеру отображать контент быстрее, не дожидаясь загрузки полных таблиц стилей.
Оставшийся CSS затем загружается асинхронно в фоновом режиме. Angular CLI
использует [Beasties](https://github.com/danielroe/beasties) для анализа HTML и стилей вашего приложения.
